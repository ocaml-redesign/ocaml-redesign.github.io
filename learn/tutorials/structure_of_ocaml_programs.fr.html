<!DOCTYPE HTML>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title> &#8211; OCaml</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Google Web Fonts -->
    <link href="http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" />
    <link href="http://fonts.googleapis.com/css?family=Domine:400,700" rel="stylesheet" />
    <!-- Only part of Bootstrap that we don't load from a CDN is our own customized CSS build. -->
    <link href="/static/css/bootstrap.css" rel="stylesheet" media="screen" />
    <link href="/static/css/bootstrap_mod.css" rel="stylesheet" media="screen" />
    <link href="/static/css/opamdoc.css" rel="stylesheet" media="screen" />
    <!--[if lt IE 9]>
        <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
    <![endif]-->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <script type="text/javascript">
      function octry(x){
        if(document.getElementById('buttons').innerHTML=='') {
          t = document.getElementById('tryocaml');
          js = document.createElement("script"); js.type = "text/javascript"; js.src = "/try-ocaml.js";
          t.appendChild(js);
        } else {
          t = document.getElementById('tryocaml');
          t.style.display = 'block';
          document.getElementById('console').value = x;
          document.getElementById('console').focus();
          document.getElementById('console').select();
        }
      }
    </script>
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="/"><img src="/static/img/ocaml.png" alt="OCaml" /></a>
          <div class="nav-collapse collapse">
                        <ul class="nav">
              <li ><a href="/learn/">Learn</a></li>
              <li ><a href="/docs/">Documentation</a></li>
              <li ><a href="/platform/">Platform</a></li>
              <li ><a href="/pkg/">Packages</a></li>
              <li ><a href="/community/">Community</a></li>
            </ul>

            <form class="navbar-search pull-right">
              <input class="search-query" type="text" placeholder="Search" />
            </form>
          </div>
        </div>
      </div>
    </nav>
    
    <div class="container">
  <div class="row">
    

    <div id="content-primary" class="span8">
      <div id='tryocaml' class="content" style='display:none;'>
        <div class="container">
          <div class="row">
            <div id="lesson-message"></div>
            <div id="languages" style='display:none;'></div>
            <div id="menu-lessons" style='display:none'>
              <table class="zebra-striped">
                <tr><td id="text-x"><code></code></td> <td id=""></td></tr>
              </table>
            </div>
            <div class="span9 ocaml">
              <div id="toplevel-container">
                <pre id="output"></pre>
                <div id="sharp">#</div>
                <div id="toplevel"></div>
              </div>
              <div id="buttons"></div>
              <div id="graphics-title"></div>
              <div id="graphics"></div>
            </div>
          </div>
        </div>
      </div>

      <div id='main-contents' class="content">
        <h1 id="StructuredesprogrammesOCaml"> Structure des programmes OCaml</h1><p>
Maintenant nous allons passer un peu de temps √† observer la structure
d&#39;ensemble de quelque vrais programmes en OCaml. Je veux vous parler des
d√©finitions locales et globales, quand utiliser <code>;;</code> ou <code>;</code>, les
modules, les fonctions imbriqu√©es, les r√©f√©rences. Pour cela nous allons
passer sur plein de concepts d&#39;OCaml qui ne vous diront rien car nous ne
les avons pas encore √©voqu√©s. Ne vous embarrassez pas des d√©tails pour
le moment. Occupez-vous uniquement de la forme g√©n√©rale des programmes,
et aux fonctionnalit√©s mises en avant.</p>
<h2 id="Variableslocalesplusexactementexpressionslocales"> ¬´¬†Variables¬†¬ª locales (<em>plus exactement</em> expressions locales)</h2><p>
Prenons la fonction <code>average</code> √©crite en C, et ajoutons lui une variable
locale. (√† comparer avec la premi√®re version que nous avions)</p>
<pre><code class='tryocaml'><span class='lower'>double</span>
<span class='lower'>average</span> <span class='keywordsign'>(</span><span class='lower'>double</span> <span class='lower'>a</span><span class='keywordsign'>,</span> <span class='lower'>double</span> <span class='lower'>b</span><span class='keywordsign'>)</span>
<span class='keywordsign'>{</span>
  <span class='lower'>double</span> <span class='lower'>sum</span> <span class='keywordsign'>=</span> <span class='lower'>a</span> <span class='keywordsign'>+</span> <span class='lower'>b</span><span class='keywordsign'>;</span>
  <span class='lower'>return</span> <span class='lower'>sum</span> <span class='keywordsign infix'>/</span> <span class='number'>2</span><span class='keywordsign'>;</span>
<span class='keywordsign'>}</span>
</code></pre>
<p>
Faisons la m√™me chose avec notre version OCaml :</p>
<pre><code class='tryocaml'><span class='keyword'>let</span> <span class='lower'>average</span> <span class='lower'>a</span> <span class='lower'>b</span> <span class='keywordsign'>=</span>
  <span class='keyword'>let</span> <span class='lower'>sum</span> <span class='keywordsign'>=</span> <span class='lower'>a</span> <span class='keywordsign infix'>+.</span> <span class='lower'>b</span> <span class='keyword'>in</span>
  <span class='lower'>sum</span> <span class='keywordsign infix'>/.</span> <span class='number'>2.0</span><span class='keywordsign'>;;</span>
</code></pre>
<p>
La formule standard <code>let nom = expression in</code> sert √† d√©finir une
expression locale nomm√©e, et <code>nom</code> peut ensuite √™tre utilis√© dans la
fonction √† la place de <code>expression</code> jusqu&#39;au <code>;;</code> qui marque la fin du
bloc de code. Remarquez que nous n&#39;avons pas chang√© l&#39;indentation apr√®s
<code>in</code>. Consid√©rez <code>let ... in</code> comme s&#39;il s&#39;agissait d&#39;une instruction.</p>
<p>Maintenant, traduire les variables locales en C par ces expressions
locales est une supercherie. En fait ils sont un peu diff√©rents. La
variable C <code>sum</code> a un emplacement r√©serv√© dans la pile. Vous pouvez
changer la valeur associ√©e √† <code>sum</code> plus loin dans la fonction si vous
voulez, ou m√™me prendre l&#39;adresse de <code>sum</code>. Ce n&#39;est PAS possible dans
la version OCaml. Dans la version OCaml, <code>sum</code> est juste une abr√©viation
pour l&#39;expression <code>a +. b</code>. Il est impossible d&#39;assigner ou de changer
la valeur de <code>sum</code>. (Nous verrons comment avoir de vraies variables un
peu plus loin).</p>
<p>Voyons un autre exemple qui devrait clarifier les choses. Les deux bouts
de code suivants devraient retourner la m√™me valeur (√† savoir (a+b) +
(a+b)<sup>2</sup>):</p>
<pre><code class='tryocaml'><span class='keyword'>let</span> <span class='lower'>f</span> <span class='lower'>a</span> <span class='lower'>b</span> <span class='keywordsign'>=</span>
  <span class='keywordsign'>(</span><span class='lower'>a</span> <span class='keywordsign infix'>+.</span> <span class='lower'>b</span><span class='keywordsign'>)</span> <span class='keywordsign infix'>+.</span> <span class='keywordsign'>(</span><span class='lower'>a</span> <span class='keywordsign infix'>+.</span> <span class='lower'>b</span><span class='keywordsign'>)</span> <span class='keywordsign infix'>**</span> <span class='number'>2.</span>
  <span class='keywordsign'>;;</span>

<span class='keyword'>let</span> <span class='lower'>f</span> <span class='lower'>a</span> <span class='lower'>b</span> <span class='keywordsign'>=</span>
  <span class='keyword'>let</span> <span class='lower'>x</span> <span class='keywordsign'>=</span> <span class='lower'>a</span> <span class='keywordsign infix'>+.</span> <span class='lower'>b</span> <span class='keyword'>in</span>
  <span class='lower'>x</span> <span class='keywordsign infix'>+.</span> <span class='lower'>x</span> <span class='keywordsign infix'>**</span> <span class='number'>2.</span>
  <span class='keywordsign'>;;</span>
</code></pre>
<p>
Il se peut que la seconde version soit plus rapide (bien que la plupart
des compilateurs devraient √™tre capable de faire cette √©tape
d&#39;&quot;√©limination de sous-expressions communes&quot; √† votre place), et en tout
cas elle est plus lisible. Dans le second exemple, <code>x</code> est une
abr√©viation pour l&#39;expression <code>a +. b</code>.</p>
<h2 id="Variablesglobalesplusprcismentexpressionsglobales"> ¬´¬†Variables¬†¬ª globales (<em>plus pr√©cis√©ment</em> expressions globales)</h2><p>
Vous pouvez aussi donner des noms √† des choses dans l&#39;environnement
global, et comme pour les &quot;variables&quot; locales ci-dessus, ce ne sont pas
vraiment des variables, mais des abbr√©viations pour ces choses. Voici un
exemple pris dans un programme r√©el :</p>
<pre><code class='tryocaml'>Characters 14:29 - 14:31 :
Error: Lexical error while reading an operator
</code></pre>
<p>
Dans ce vrai morceau de code, <code>html</code> est un &quot;widget&quot; (&quot;contr√¥le&quot;)
d&#39;√©dition de HTML (un objet provenant de la biblioth√®que lablgtk), cr√©√©
une fois pour toute au d√©but du programme par la premi√®re instruction
<code>let html =</code>. Il y est ensuite fait r√©f√©rence dans plusieurs des
fonctions suivantes.</p>
<p>A noter que le nom <code>html</code> dans le bout de programme ci-dessus ne devrait
pas √™tre compar√© √† une vraie variable globale comme en C ou dans
d&#39;autres langages imp√©ratifs. Aucun emplacement n&#39;est r√©serv√© pour
&quot;stocker&quot; le &quot;pointeur sur <code>html</code>&quot;. Il n&#39;est pas non plus possible
d&#39;assigner quelque chose √† <code>html</code>, par exemple pour lui faire d√©signer
un autre widget. Dans la section suivante nous parlerons des r√©f√©rences,
qui sont de vraies variables.</p>
<h2 id="Letbinding"> Let-binding (?)</h2><p>
Les utilisations de <code>let ...</code> aussi bien au niveau global que dans une
fonction, sont souvent appell√©es des <strong>let-binding</strong>.</p>
<h2 id="Rfrenceslesvraiesvariables"> R√©f√©rences : les vraies variables</h2><p>
Comment faire si vous voulez une vraie variable que vous pouvez assigner
puis changer √† votre gr√© dans votre programme ? Il vous faut une
<strong>r√©f√©rence</strong>. Les r√©f√©rences sont similaires aux pointeurs en C/C++. En
Java, toutes les variables qui stockent des objets sont en fait des
r√©f√©rences (pointeurs) sur ces objets. En Perl, les r√©f√©rences sont des
r√©f√©rences - comme en OCaml.</p>
<p>Voici comment cr√©er une r√©f√©rence sur un entier (<code>int</code>) en OCaml :</p>
<pre><code class='tryocaml'><span class='lower'>ref</span> <span class='number'>0</span><span class='keywordsign'>;;</span>
</code></pre>
<p>
En fait cette instruction n&#39;est pas tr√®s utile. Nous avons cr√©√© une
r√©f√©rence et puis, comme elle n&#39;a pas de nom, le glaneur de cellules a
fait son travail et l&#39;a imm√©diatement lib√©r√©e! (Il est m√™me probable que
le compileur ait √©limin√© cette instruction √† la compilation). Donnons un
nom √† cette r√©f√©rence :</p>
<pre><code class='tryocaml'><span class='keyword'>let</span> <span class='lower'>my_ref</span> <span class='keywordsign'>=</span> <span class='lower'>ref</span> <span class='number'>0</span><span class='keywordsign'>;;</span>
</code></pre>
<p>
Cette r√©f√©rence contient maintenant l&#39;entier 0. Mettons une autre valeur
√† la place (assignement) :</p>
<pre><code class='tryocaml'><span class='lower'>my_ref</span> <span class='keywordsign'>:=</span> <span class='number'>100</span><span class='keywordsign'>;;</span>
</code></pre>
<p>
Voyons ce que la r√©f√©rence contient √† pr√©sent :</p>
<pre><code class='tryocaml'><span class='keywordsign'>#</span> <span class='keywordsign prefix'>!</span><span class='lower'>my_ref</span><span class='keywordsign'>;;</span>
<span class='keywordsign'>-</span> <span class='keywordsign'>:</span> <span class='lower'>int</span> <span class='keywordsign'>=</span> <span class='number'>100</span>
</code></pre>
<p>
Donc l&#39;op√©rateur <code>:=</code> est utilis√© pour assigner les r√©f√©rences, et <code>!</code>
pour les d√©r√©f√©rencer et acc√©der au contenu. Voici une comparaison
approximative avec C/C++ :</p>
<pre><code class='tryocaml'><span class='constructor module'>OCaml</span>                   <span class='constructor module'>C</span><span class='keywordsign infix'>/</span><span class='constructor module'>C</span><span class='keywordsign infix'>++</span>

<span class='keyword'>let</span> <span class='lower'>my_ref</span> <span class='keywordsign'>=</span> <span class='lower'>ref</span> <span class='number'>0</span><span class='keywordsign'>;;</span>    <span class='lower'>int</span> <span class='lower'>a</span> <span class='keywordsign'>=</span> <span class='number'>0</span><span class='keywordsign'>;</span> <span class='lower'>int</span> <span class='keywordsign'>*</span><span class='lower'>my_ptr</span> <span class='keywordsign'>=</span> <span class='keywordsign'>&#38;</span><span class='lower'>a</span><span class='keywordsign'>;</span>
<span class='lower'>my_ref</span> <span class='keywordsign'>:=</span> <span class='number'>100</span><span class='keywordsign'>;;</span>         <span class='keywordsign'>*</span><span class='lower'>my_ptr</span> <span class='keywordsign'>=</span> <span class='number'>100</span><span class='keywordsign'>;</span>
<span class='keywordsign prefix'>!</span><span class='lower'>my_ref</span>                 <span class='keywordsign'>*</span><span class='lower'>my_ptr</span>
</code></pre>
<p>
Les r√©f√©rences ont leurs usages, mais vous vous apercevrez que vous ne
les utiliserez pas si souvent. La plupart du temps, vous utiliserez
<code>let nom = expression in</code> pour nommer des expressions locales dans vos
d√©finitions de fonctions.</p>
<h2 id="Fonctionsimbriques"> Fonctions imbriqu√©es</h2><p>
Le langage C n&#39;a pas r√©ellement de notion de fonctions imbriqu√©es. GCC
les supporte, mais je ne connais pas de programme qui en tire parti. En
tout cas, voici ce que la page info de gcc dit sur les fonctions
imbriqu√©es :</p>
<p>Une &quot;fonction imbriqu√©e&quot; est une fonction d√©finie √† l&#39;int√©rieur d&#39;une
autre fonction (les fonctions imbriqu√©es ne sont pas support√©es par GNU
C++.) Le nom de la fonction imbriqu√©e est local au bloc dans lequel il
est d√©fini. Par exemple, d√©finissons une fonction imbriqu√©e nomm√©e</p>
<pre><code>square&#39;, et appelons-l√† deux fois :

```tryocaml
foo (double a, double b)
{
  double square (double z) { return z * z; }

  return square (a) + square (b);
}
```
La fonction imbriqu√©e a acc√®s √† toutes les variables de la fonction
englobante qui sont visibles √† l&#39;emplacement de sa d√©finition. Cela
s&#39;appelle la &quot;port√©e lexicale&quot;. Par exemple, voici une fonction
imbriqu√©e qui utilise une variable h√©rit√©e nomm√©e </code></pre>
<p>offset&#39; :</p>
<pre><code class='tryocaml'><span class='lower'>bar</span> <span class='keywordsign'>(</span><span class='lower'>int</span> <span class='keywordsign'>*</span><span class='lower'>array</span><span class='keywordsign'>,</span> <span class='lower'>int</span> <span class='lower'>offset</span><span class='keywordsign'>,</span> <span class='lower'>int</span> <span class='lower'>size</span><span class='keywordsign'>)</span>
<span class='keywordsign'>{</span>
  <span class='lower'>int</span> <span class='lower'>access</span> <span class='keywordsign'>(</span><span class='lower'>int</span> <span class='keywordsign'>*</span><span class='lower'>array</span><span class='keywordsign'>,</span> <span class='lower'>int</span> <span class='lower'>index</span><span class='keywordsign'>)</span>
    <span class='keywordsign'>{</span> <span class='lower'>return</span> <span class='lower'>array</span><span class='keywordsign'>[</span><span class='lower'>index</span> <span class='keywordsign'>+</span> <span class='lower'>offset</span><span class='keywordsign'>]</span><span class='keywordsign'>;</span> <span class='keywordsign'>}</span>
  <span class='lower'>int</span> <span class='lower'>i</span><span class='keywordsign'>;</span>
  <span class='keywordsign infix'>/*</span> <span class='keywordsign operator'>...</span> <span class='keywordsign infix'>*/</span>
  <span class='keyword'>for</span> <span class='keywordsign'>(</span><span class='lower'>i</span> <span class='keywordsign'>=</span> <span class='number'>0</span><span class='keywordsign'>;</span> <span class='lower'>i</span> <span class='keywordsign'>&#60;</span> <span class='lower'>size</span><span class='keywordsign'>;</span> <span class='lower'>i</span><span class='keywordsign infix'>++</span><span class='keywordsign'>)</span>
    <span class='keywordsign infix'>/*</span> <span class='keywordsign operator'>...</span> <span class='keywordsign infix'>*/</span> <span class='lower'>access</span> <span class='keywordsign'>(</span><span class='lower'>array</span><span class='keywordsign'>,</span> <span class='lower'>i</span><span class='keywordsign'>)</span> <span class='keywordsign infix'>/*</span> <span class='keywordsign operator'>...</span> <span class='keywordsign infix'>*/</span>
<span class='keywordsign'>}</span>
</code></pre>
<p>
Vous comprenez l&#39;id√©e. Les fonctions imbriqu√©es sont, cependant, tr√®s
utiles et largement employ√©es en OCaml. Voici un exemple d&#39;utilisation
r√©el de fonction imbriqu√©es :</p>
<pre><code class='tryocaml'><span class='keyword'>let</span> <span class='lower'>read_whole_channel</span> <span class='lower'>chan</span> <span class='keywordsign'>=</span>
  <span class='keyword'>let</span> <span class='lower'>buf</span> <span class='keywordsign'>=</span> <span class='constructor module'>Buffer</span><span class='keywordsign'>.</span><span class='lower'>create</span> <span class='number'>4096</span> <span class='keyword'>in</span>
  <span class='keyword'>let</span> <span class='keyword'>rec</span> <span class='lower'>loop</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span> <span class='keywordsign'>=</span>
    <span class='keyword'>let</span> <span class='lower'>newline</span> <span class='keywordsign'>=</span> <span class='lower'>input_line</span> <span class='lower'>chan</span> <span class='keyword'>in</span>
    <span class='constructor module'>Buffer</span><span class='keywordsign'>.</span><span class='lower'>add_string</span> <span class='lower'>buf</span> <span class='lower'>newline</span><span class='keywordsign'>;</span>
    <span class='constructor module'>Buffer</span><span class='keywordsign'>.</span><span class='lower'>add_char</span> <span class='lower'>buf</span> <span class='string'>&#39;\n&#39;</span><span class='keywordsign'>;</span>
    <span class='lower'>loop</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span>
  <span class='keyword'>in</span>
  <span class='keyword'>try</span>
    <span class='lower'>loop</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span>
  <span class='keyword'>with</span>
    <span class='constructor module'>End_of_file</span> <span class='keywordsign'>-&#62;</span> <span class='constructor module'>Buffer</span><span class='keywordsign'>.</span><span class='lower'>contents</span> <span class='lower'>buf</span><span class='keywordsign'>;;</span>
</code></pre>
<p>
Ne vous inqui√©tez pas de ce que ce code fait - il utilise beaucoup de
concepts que nous n&#39;avons pas encore vu dans ce tutorial.
Concentrez-vous plut√¥t sur la fonction imbriqu√©e principale nomm√©e
<code>loop</code> qui ne prend qu&#39;un argument unit. On peut appeler <code>loop ()</code>
depuis l&#39;int√©rieur de la fonction <code>read_whole_channel</code>, mais elle n&#39;est
pas d√©finie en dehors de cette fonction. La fonction imbriqu√©e peut
acc√©der aux variables d√©finies dans la fonction principale (ici <code>loop</code>
acc√®de au nom local <code>buf</code>.)</p>
<p>La syntaxe des fonctions imbriqu√©es est la m√™me que pour nommer les
expressions locales : <code>let nom arguments = d√©finition de fonction in</code>.</p>
<p>Normalement, vous indenterez la d√©finition de fonction, apr√®s √™tre pass√©
√† la ligne comme dans l&#39;exemple pr√©c√©dent, et n&#39;oubliez pas d&#39;utiliser
<code>let rec</code> √† la place de <code>let</code> si votre fonction est r√©cursive (comme
dans cet exemple).</p>
<h2 id="Modulesetopen"> Modules et <code>open</code></h2><p>
OCaml est accompagn√© d&#39;une quantit√© de modules amusants et int√©ressants,
de biblioth√®ques de code utile. Par exemple on y trouve une biblioth√®que
pour dessiner des graphismes, interagir avec la collection de contr√¥les
de l&#39;interface-utilisateur graphique, pour manipuler des grands nombres,
des structures de donn√©es, ou pour faire des appels syst√®mes POSIX. Ces
biblioth√®ques se trouvent dans <code>/usr/lib/ocaml/VERSION/</code> (sous Unix en
tout cas). Pour ces exemples, nous allons nous concentrer sur un module
relativement simple appel√© <code>Graphics</code>.</p>
<p>Le module <code>Graphics</code> est constitu√© de cinq fichiers (sur mon syst√®me) :</p>
<pre><code class='tryocaml'><span class='keywordsign infix'>/</span><span class='lower'>usr</span><span class='keywordsign infix'>/</span><span class='lower'>lib</span><span class='keywordsign infix'>/</span><span class='lower'>ocaml</span><span class='keywordsign infix'>/</span><span class='lower'>graphics</span><span class='keywordsign'>.</span><span class='lower'>a</span>
<span class='keywordsign infix'>/</span><span class='lower'>usr</span><span class='keywordsign infix'>/</span><span class='lower'>lib</span><span class='keywordsign infix'>/</span><span class='lower'>ocaml</span><span class='keywordsign infix'>/</span><span class='lower'>graphics</span><span class='keywordsign'>.</span><span class='lower'>cma</span>
<span class='keywordsign infix'>/</span><span class='lower'>usr</span><span class='keywordsign infix'>/</span><span class='lower'>lib</span><span class='keywordsign infix'>/</span><span class='lower'>ocaml</span><span class='keywordsign infix'>/</span><span class='lower'>graphics</span><span class='keywordsign'>.</span><span class='lower'>cmi</span>
<span class='keywordsign infix'>/</span><span class='lower'>usr</span><span class='keywordsign infix'>/</span><span class='lower'>lib</span><span class='keywordsign infix'>/</span><span class='lower'>ocaml</span><span class='keywordsign infix'>/</span><span class='lower'>graphics</span><span class='keywordsign'>.</span><span class='lower'>cmxa</span>
<span class='keywordsign infix'>/</span><span class='lower'>usr</span><span class='keywordsign infix'>/</span><span class='lower'>lib</span><span class='keywordsign infix'>/</span><span class='lower'>ocaml</span><span class='keywordsign infix'>/</span><span class='lower'>graphics</span><span class='keywordsign'>.</span><span class='lower'>mli</span>
</code></pre>
<p>
Pour l&#39;instant occupons-nous de <code>graphics.mli</code>. C&#39;est un fichier texte,
que vous pouvez donc lire d√®s √† pr√©sent. Notez que son nom est
<code>graphics.mli</code> et non <code>Graphics.mli</code>. OCaml met automatiquement une
capitale au nom du fichier pour obtenir le nom du module. C&#39;est
d√©routant quand on ne le sait pas !</p>
<p>Il y a deux moyens pour utiliser les fonctions de <code>Graphics</code>. Ou bien on
commence son programme par la d√©claration <code>open Graphics;;</code>, ou bien on
pr√©fixe tous les appels de fonctions comme ceci : <code>Graphics.open_graph</code>.
<code>open</code> ressemble un peu √† l&#39;instruction <code>import</code> en Java, ou plus encore
comme l&#39;instruction <code>use</code> en Perl.</p>
<p>Une paire d&#39;exemples devrait √©claircir ce point. (Les deux exemples
dessinent des choses diff√©rentes - essayez-les). Remarquez que le
premier exemple appelle <code>open_graph</code> et le second <code>Graphics.open_graph</code>.</p>
<pre><code class='tryocaml'><span class='comment'>(* To compile this example: ocamlc graphics.cma grtest1.ml -o grtest1 *)</span>

<span class='keyword'>open</span> <span class='constructor module'>Graphics</span><span class='keywordsign'>;;</span>

<span class='lower'>open_graph</span> <span class='string'>&#34; 640x480&#34;</span><span class='keywordsign'>;;</span>
<span class='keyword'>for</span> <span class='lower'>i</span> <span class='keywordsign'>=</span> <span class='number'>12</span> <span class='keyword'>downto</span> <span class='number'>1</span> <span class='keyword'>do</span>
  <span class='keyword'>let</span> <span class='lower'>radius</span> <span class='keywordsign'>=</span> <span class='lower'>i</span> <span class='keywordsign'>*</span> <span class='number'>20</span> <span class='keyword'>in</span>
  <span class='lower'>set_color</span> <span class='keywordsign'>(</span><span class='keyword'>if</span> <span class='keywordsign'>(</span><span class='lower'>i</span> <span class='keyword'>mod</span> <span class='number'>2</span><span class='keywordsign'>)</span> <span class='keywordsign'>=</span> <span class='number'>0</span> <span class='keyword'>then</span> <span class='lower'>red</span> <span class='keyword'>else</span> <span class='lower'>yellow</span><span class='keywordsign'>)</span><span class='keywordsign'>;</span>
  <span class='lower'>fill_circle</span> <span class='number'>320</span> <span class='number'>240</span> <span class='lower'>radius</span>
<span class='keyword'>done</span><span class='keywordsign'>;;</span>
<span class='lower'>read_line</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span><span class='keywordsign'>;;</span>

<span class='comment'>(* To compile this example: ocamlc graphics.cma grtest2.ml -o grtest2 *)</span>

<span class='constructor module'>Random</span><span class='keywordsign'>.</span><span class='lower'>self_init</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span><span class='keywordsign'>;;</span>
<span class='constructor module'>Graphics</span><span class='keywordsign'>.</span><span class='lower'>open_graph</span> <span class='string'>&#34; 640x480&#34;</span><span class='keywordsign'>;;</span>

<span class='keyword'>let</span> <span class='keyword'>rec</span> <span class='lower'>iterate</span> <span class='lower'>r</span> <span class='lower'>x_init</span> <span class='lower'>i</span> <span class='keywordsign'>=</span>
        <span class='keyword'>if</span> <span class='lower'>i</span> <span class='keywordsign'>=</span> <span class='number'>1</span> <span class='keyword'>then</span> <span class='lower'>x_init</span>
        <span class='keyword'>else</span>
                <span class='keyword'>let</span> <span class='lower'>x</span> <span class='keywordsign'>=</span> <span class='lower'>iterate</span> <span class='lower'>r</span> <span class='lower'>x_init</span> <span class='keywordsign'>(</span><span class='lower'>i</span><span class='keywordsign'>-</span><span class='number'>1</span><span class='keywordsign'>)</span> <span class='keyword'>in</span>
                <span class='lower'>r</span> <span class='keywordsign infix'>*.</span> <span class='lower'>x</span> <span class='keywordsign infix'>*.</span> <span class='keywordsign'>(</span><span class='number'>1.0</span> <span class='keywordsign'>-.</span> <span class='lower'>x</span><span class='keywordsign'>)</span><span class='keywordsign'>;;</span>

<span class='keyword'>for</span> <span class='lower'>x</span> <span class='keywordsign'>=</span> <span class='number'>0</span> <span class='keyword'>to</span> <span class='number'>639</span> <span class='keyword'>do</span>
        <span class='keyword'>let</span> <span class='lower'>r</span> <span class='keywordsign'>=</span> <span class='number'>4.0</span> <span class='keywordsign infix'>*.</span> <span class='keywordsign'>(</span><span class='lower'>float_of_int</span> <span class='lower'>x</span><span class='keywordsign'>)</span> <span class='keywordsign infix'>/.</span> <span class='number'>640</span><span class='keywordsign'>.</span><span class='number'>0</span> <span class='keyword'>in</span>
        <span class='keyword'>for</span> <span class='lower'>i</span> <span class='keywordsign'>=</span> <span class='number'>0</span> <span class='keyword'>to</span> <span class='number'>39</span> <span class='keyword'>do</span>
                <span class='keyword'>let</span> <span class='lower'>x_init</span> <span class='keywordsign'>=</span> <span class='constructor module'>Random</span><span class='keywordsign'>.</span><span class='lower'>float</span> <span class='number'>1.0</span> <span class='keyword'>in</span>
                <span class='keyword'>let</span> <span class='lower'>x_final</span> <span class='keywordsign'>=</span> <span class='lower'>iterate</span> <span class='lower'>r</span> <span class='lower'>x_init</span> <span class='number'>500</span> <span class='keyword'>in</span>
                <span class='keyword'>let</span> <span class='lower'>y</span> <span class='keywordsign'>=</span> <span class='lower'>int_of_float</span> <span class='keywordsign'>(</span><span class='lower'>x_final</span> <span class='keywordsign infix'>*.</span> <span class='number'>480</span><span class='keywordsign'>.</span><span class='keywordsign'>)</span> <span class='keyword'>in</span>
                <span class='constructor module'>Graphics</span><span class='keywordsign'>.</span><span class='lower'>plot</span> <span class='lower'>x</span> <span class='lower'>y</span>
        <span class='keyword'>done</span>
<span class='keyword'>done</span><span class='keywordsign'>;;</span>

<span class='lower'>read_line</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span><span class='keywordsign'>;;</span>
</code></pre>
<p>
Ces deux exemples utilisent des fonctionnalit√©s dont nous n&#39;avons pas
encore parl√© : boucles &quot;for&quot; dans le style imp√©ratif, if-then-else, et
r√©cursion. Nous en parlerons plus tard. Examinez-les cependant, et
essayez de comprendre (1) comment ils fonctionnent, et (2) comment
l&#39;inf√©rence de type aide √† √©liminer des bugs.</p>
<h2 id="LemodulePervasives"> Le module <code>Pervasives</code></h2><p>
Il y a un module que vous n&#39;avez jamais besoin d&#39;ouvrir avec <code>open</code>,
c&#39;est le module <code>Pervasives</code> (allez jeter un oeil sur
<code>/usr/lib/ocaml/VERSION/pervasives.mli</code>). Tous les symboles d√©finis dans
le module <code>Pervasives</code> sont implicitement import√©s dans tous les
programmes OCaml.</p>
<h2 id="Renommagedemodules"> Renommage de modules</h2><p>
Que faire si vous voulez utiliser des symboles en provenance du module
<code>Graphics</code>, mais ne voulez pas tous les importer, et n&#39;avez pas envie de
taper <code>Graphics.</code> √† chaque fois ? Renommez le module avec cette astuce :</p>
<pre><code class='tryocaml'><span class='keyword'>module</span> <span class='constructor module'>Gr</span> <span class='keywordsign'>=</span> <span class='constructor module'>Graphics</span><span class='keywordsign'>;;</span>

<span class='constructor module'>Gr</span><span class='keywordsign'>.</span><span class='lower'>open_graph</span> <span class='string'>&#34; 640x480&#34;</span><span class='keywordsign'>;;</span>
<span class='constructor module'>Gr</span><span class='keywordsign'>.</span><span class='lower'>fill_circle</span> <span class='number'>320</span> <span class='number'>240</span> <span class='number'>240</span><span class='keywordsign'>;;</span>
<span class='lower'>read_line</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span><span class='keywordsign'>;;</span>
</code></pre>
<p>
Cela devient vraiment utile quand vous voulez utiliser les symboles d&#39;un
module imbriqu√© (les modules peuvent √™tre imbriqu√©s les uns dans les
autres, eux-aussi), mais ne voulez pas avoir √† taper √† chaque fois le
chemin d&#39;acc√®s au module imbriqu√©.</p>
<h2 id="Utiliseretomettreet"> Utiliser et omettre <code>;;</code> et <code>;</code></h2><p>
Maintenant nous allons aborder un probl√®me important. Quand utiliser
<code>;;</code>, quand utiliser <code>;</code>, et quand n&#39;utiliser aucun des deux ? C&#39;est une
question tordue, qui m&#39;a √©galement emb√™t√© pendant longtemps alors que
j&#39;apprenais le langage OCaml.</p>
<p>La r√®gle n¬∞1 est que vous devriez utiliser <code>;;</code> pour s√©parer les
instructions de niveau g√©n√©ral dans votre code, et <em>jamais</em> au milieu
d&#39;une d√©finition de fonction ou d&#39;aucune autre instruction.</p>
<p>Reprenons un bout du second exemple graphique pr√©c√©dent:</p>
<pre><code class='tryocaml'><span class='constructor module'>Random</span><span class='keywordsign'>.</span><span class='lower'>self_init</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span><span class='keywordsign'>;;</span>
<span class='constructor module'>Graphics</span><span class='keywordsign'>.</span><span class='lower'>open_graph</span> <span class='string'>&#34; 640x480&#34;</span><span class='keywordsign'>;;</span>

<span class='keyword'>let</span> <span class='keyword'>rec</span> <span class='lower'>iterate</span> <span class='lower'>r</span> <span class='lower'>x_init</span> <span class='lower'>i</span> <span class='keywordsign'>=</span>
        <span class='keyword'>if</span> <span class='lower'>i</span> <span class='keywordsign'>=</span> <span class='number'>1</span> <span class='keyword'>then</span> <span class='lower'>x_init</span>
        <span class='keyword'>else</span>
                <span class='keyword'>let</span> <span class='lower'>x</span> <span class='keywordsign'>=</span> <span class='lower'>iterate</span> <span class='lower'>r</span> <span class='lower'>x_init</span> <span class='keywordsign'>(</span><span class='lower'>i</span><span class='keywordsign'>-</span><span class='number'>1</span><span class='keywordsign'>)</span> <span class='keyword'>in</span>
                <span class='lower'>r</span> <span class='keywordsign infix'>*.</span> <span class='lower'>x</span> <span class='keywordsign infix'>*.</span> <span class='keywordsign'>(</span><span class='number'>1.0</span> <span class='keywordsign'>-.</span> <span class='lower'>x</span><span class='keywordsign'>)</span><span class='keywordsign'>;;</span>
</code></pre>
<p>
Nous avons deux instructions au niveau global et une d√©finition de
fonction (la fonction nomm√©e <code>iterate</code>). Chacune est suivie par <code>;;</code>.</p>
<p>La r√®gle n¬∞2 est que <em>parfois</em> vous pouvez omettre <code>;;</code>. En tant que
d√©butant vous pouvez vous dispenser de cette r√®gle - et toujours
utiliser <code>;;</code> comme prescrit par la r√®gle n¬∞1. Mais puisque vous aurez
s√ªrement √† lire du code √©crit par d&#39;autres, vous devez savoir que <code>;;</code>
peut parfois √™tre omis. Les endroits o√π cela est possible sont :</p>
<ul>
 <li>Avant le mot cl√© <code>let</code>.
 </li>
 <li>Avant le mot cl√© <code>open</code>.
 </li>
 <li>Avant le mot cl√© <code>type</code>.
 </li>
 <li>√Ä la toute fin du fichier
 </li>
 <li>√Ä quelques (tr√®s rares) endroits o√π OCaml peut deviner que ce qui
 vient ensuite est une nouvelle instruction et non la suite de
 l&#39;instruction courante.</li>
</ul>

<p>Voici un exemple de code correct, o√π <code>;;</code> a √©t√© omis quand c&#39;√©tait
possible :</p>
<pre><code class='tryocaml'><span class='keyword'>open</span> <span class='constructor module'>Random</span>                   <span class='comment'>(* ;; *)</span>
<span class='keyword'>open</span> <span class='constructor module'>Graphics</span><span class='keywordsign'>;;</span>

<span class='lower'>self_init</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span><span class='keywordsign'>;;</span>
<span class='lower'>open_graph</span> <span class='string'>&#34; 640x480&#34;</span>         <span class='comment'>(* ;; *)</span>

<span class='keyword'>let</span> <span class='keyword'>rec</span> <span class='lower'>iterate</span> <span class='lower'>r</span> <span class='lower'>x_init</span> <span class='lower'>i</span> <span class='keywordsign'>=</span>
        <span class='keyword'>if</span> <span class='lower'>i</span> <span class='keywordsign'>=</span> <span class='number'>1</span> <span class='keyword'>then</span> <span class='lower'>x_init</span>
        <span class='keyword'>else</span>
                <span class='keyword'>let</span> <span class='lower'>x</span> <span class='keywordsign'>=</span> <span class='lower'>iterate</span> <span class='lower'>r</span> <span class='lower'>x_init</span> <span class='keywordsign'>(</span><span class='lower'>i</span><span class='keywordsign'>-</span><span class='number'>1</span><span class='keywordsign'>)</span> <span class='keyword'>in</span>
                <span class='lower'>r</span> <span class='keywordsign infix'>*.</span> <span class='lower'>x</span> <span class='keywordsign infix'>*.</span> <span class='keywordsign'>(</span><span class='number'>1.0</span> <span class='keywordsign'>-.</span> <span class='lower'>x</span><span class='keywordsign'>)</span><span class='keywordsign'>;;</span>

<span class='keyword'>for</span> <span class='lower'>x</span> <span class='keywordsign'>=</span> <span class='number'>0</span> <span class='keyword'>to</span> <span class='number'>639</span> <span class='keyword'>do</span>
        <span class='keyword'>let</span> <span class='lower'>r</span> <span class='keywordsign'>=</span> <span class='number'>4.0</span> <span class='keywordsign infix'>*.</span> <span class='keywordsign'>(</span><span class='lower'>float_of_int</span> <span class='lower'>x</span><span class='keywordsign'>)</span> <span class='keywordsign infix'>/.</span> <span class='number'>640</span><span class='keywordsign'>.</span><span class='number'>0</span> <span class='keyword'>in</span>
        <span class='keyword'>for</span> <span class='lower'>i</span> <span class='keywordsign'>=</span> <span class='number'>0</span> <span class='keyword'>to</span> <span class='number'>39</span> <span class='keyword'>do</span>
                <span class='keyword'>let</span> <span class='lower'>x_init</span> <span class='keywordsign'>=</span> <span class='constructor module'>Random</span><span class='keywordsign'>.</span><span class='lower'>float</span> <span class='number'>1.0</span> <span class='keyword'>in</span>
                <span class='keyword'>let</span> <span class='lower'>x_final</span> <span class='keywordsign'>=</span> <span class='lower'>iterate</span> <span class='lower'>r</span> <span class='lower'>x_init</span> <span class='number'>500</span> <span class='keyword'>in</span>
                <span class='keyword'>let</span> <span class='lower'>y</span> <span class='keywordsign'>=</span> <span class='lower'>int_of_float</span> <span class='keywordsign'>(</span><span class='lower'>x_final</span> <span class='keywordsign infix'>*.</span> <span class='number'>480</span><span class='keywordsign'>.</span><span class='keywordsign'>)</span> <span class='keyword'>in</span>
                <span class='constructor module'>Graphics</span><span class='keywordsign'>.</span><span class='lower'>plot</span> <span class='lower'>x</span> <span class='lower'>y</span>
        <span class='keyword'>done</span>
<span class='keyword'>done</span><span class='keywordsign'>;;</span>

<span class='lower'>read_line</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span>                  <span class='comment'>(* ;; *)</span>
</code></pre>
<p>
Les r√®gles n¬∞3 et n¬∞4 concernent le simple <code>;</code>. Il n&#39;a rien √† voir avec
<code>;;</code>. Le point-virgule simple <code>;</code> est le <strong>s√©parateur de s√©quence</strong>,
c&#39;est √† dire qu&#39;il a le m√™me r√¥le que le point-virgule en C, C++, Java
ou Perl. Il signifie &quot;fait ce qu&#39;il y a avant en premier, et quand c&#39;est
termin√©, fait ce qu&#39;il y a apr√®s&quot;. Je suis s√ªr que vous l&#39;ignoriez.</p>
<p>La r√®gle n¬∞3 est : Consid√©rez <code>let ... in</code> comme une instruction, et ne
mettez jamais un simple <code>;</code> apr√®s lui.</p>
<p>La r√®gle n¬∞4 est : Pour tous les autres instructions dans un bloc de
code, faites-les suivre par un simple <code>;</code>, <em>√† l&#39;exception</em> de la
derni√®re.</p>
<p>La boucle for interne de notre exemple ci-dessus est une bonne
d√©monstration. Remarquez que nous n&#39;utilisons jamais de simple <code>;</code> dans
ce code :</p>
<pre><code class='tryocaml'>        <span class='keyword'>for</span> <span class='lower'>i</span> <span class='keywordsign'>=</span> <span class='number'>0</span> <span class='keyword'>to</span> <span class='number'>39</span> <span class='keyword'>do</span>
                <span class='keyword'>let</span> <span class='lower'>x_init</span> <span class='keywordsign'>=</span> <span class='constructor module'>Random</span><span class='keywordsign'>.</span><span class='lower'>float</span> <span class='number'>1.0</span> <span class='keyword'>in</span>
                <span class='keyword'>let</span> <span class='lower'>x_final</span> <span class='keywordsign'>=</span> <span class='lower'>iterate</span> <span class='lower'>r</span> <span class='lower'>x_init</span> <span class='number'>500</span> <span class='keyword'>in</span>
                <span class='keyword'>let</span> <span class='lower'>y</span> <span class='keywordsign'>=</span> <span class='lower'>int_of_float</span> <span class='keywordsign'>(</span><span class='lower'>x_final</span> <span class='keywordsign infix'>*.</span> <span class='number'>480</span><span class='keywordsign'>.</span><span class='keywordsign'>)</span> <span class='keyword'>in</span>
                <span class='constructor module'>Graphics</span><span class='keywordsign'>.</span><span class='lower'>plot</span> <span class='lower'>x</span> <span class='lower'>y</span>
        <span class='keyword'>done</span>
</code></pre>
<p>
Le seul endroit dans ce code o√π on pourrait imaginer mettre un <code>;</code> est
apr√®s <code>Graphics.plot x y</code>, mais comme c&#39;est la derni√®re instruction de
son bloc, la r√®gle n¬∞4 nous dit qu&#39;il ne faut pas le faire.</p>
<p><strong>Remarque √† propos de &quot;;&quot;</strong> Brian Hurt m&#39;a √©crit pour me corriger au
sujet de &quot;;&quot;</p>
<p><code>;</code> est un op√©rateur, au m√™me titre que <code>+</code> est un op√©rateur. Enfin,
peut-√™tre pas tout √† fait, mais conceptuellement ils sont de m√™me
nature. <code>+</code> est de type <code>int -&gt; int -&gt; int</code> - il prend deux entiers et
retourne un entier (leur somme). <code>;</code> est de type <code>unit -&gt; &#39;b -&gt; &#39;b</code> - il
prend deux valeurs et retourne uniquement la seconde. Un peu comme
l&#39;op√©rateur <code>,</code> (virgule) en C. Ecrire <code>a ; b ; c ; d</code> est aussi naturel
que d&#39;√©crire <code> a + b + c + d</code>.</p>
<p>C&#39;est un de ces &quot;sauts conceptuels&quot; qui ne sont jamais explicit√©s
clairement - en OCaml, quasiment tout est une expression. <code>if/then/else</code>
est une expression. <code>a ; b</code> est une expression. <code>match foo with ...</code> est
une expression. Les codes suivants sont parfaitement l√©gaux (et tous
font la m√™me chose) :</p>
<pre><code class='tryocaml'><span class='keyword'>let</span> <span class='lower'>f</span> <span class='lower'>x</span> <span class='lower'>b</span> <span class='lower'>y</span> <span class='keywordsign'>=</span> <span class='keyword'>if</span> <span class='lower'>b</span> <span class='keyword'>then</span> <span class='lower'>x</span><span class='keywordsign'>+</span><span class='lower'>y</span> <span class='keyword'>else</span> <span class='lower'>x</span><span class='keywordsign'>+</span><span class='number'>0</span>

<span class='keyword'>let</span> <span class='lower'>f</span> <span class='lower'>x</span> <span class='lower'>b</span> <span class='lower'>y</span> <span class='keywordsign'>=</span> <span class='lower'>x</span> <span class='keywordsign'>+</span> <span class='keywordsign'>(</span><span class='keyword'>if</span> <span class='lower'>b</span> <span class='keyword'>then</span> <span class='lower'>y</span> <span class='keyword'>else</span> <span class='number'>0</span><span class='keywordsign'>)</span>

<span class='keyword'>let</span> <span class='lower'>f</span> <span class='lower'>x</span> <span class='lower'>b</span> <span class='lower'>y</span> <span class='keywordsign'>=</span> <span class='lower'>x</span> <span class='keywordsign'>+</span> <span class='keywordsign'>(</span><span class='keyword'>match</span> <span class='lower'>b</span> <span class='keyword'>with</span> <span class='keyword'>true</span> <span class='keywordsign'>-&#62;</span> <span class='lower'>y</span> <span class='keywordsign'>|</span> <span class='keyword'>false</span> <span class='keywordsign'>-&#62;</span> <span class='number'>0</span><span class='keywordsign'>)</span>

<span class='keyword'>let</span> <span class='lower'>f</span> <span class='lower'>x</span> <span class='lower'>b</span> <span class='lower'>y</span> <span class='keywordsign'>=</span> <span class='lower'>x</span> <span class='keywordsign'>+</span> <span class='keywordsign'>(</span><span class='keyword'>let</span> <span class='lower'>g</span> <span class='lower'>z</span> <span class='keywordsign'>=</span> <span class='keyword'>function</span> <span class='keyword'>true</span> <span class='keywordsign'>-&#62;</span> <span class='lower'>z</span> <span class='keywordsign'>|</span> <span class='keyword'>false</span> <span class='keywordsign'>-&#62;</span> <span class='number'>0</span> <span class='keyword'>in</span> <span class='lower'>g</span> <span class='lower'>y</span> <span class='lower'>b</span><span class='keywordsign'>)</span>

<span class='keyword'>let</span> <span class='lower'>f</span> <span class='lower'>x</span> <span class='lower'>b</span> <span class='lower'>y</span> <span class='keywordsign'>=</span> <span class='lower'>x</span> <span class='keywordsign'>+</span> <span class='keywordsign'>(</span><span class='keyword'>let</span> <span class='keywordsign'>_</span> <span class='keywordsign'>=</span> <span class='lower'>y</span> <span class='keywordsign'>+</span> <span class='number'>3</span> <span class='keyword'>in</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span><span class='keywordsign'>;</span> <span class='keyword'>if</span> <span class='lower'>b</span> <span class='keyword'>then</span> <span class='lower'>y</span> <span class='keyword'>else</span> <span class='number'>0</span><span class='keywordsign'>)</span>
</code></pre>
<p>
Notez tout particuli√®rement la derni√®re fonction - j&#39;utilise <code>;</code> comme
op√©rateur pour &quot;joindre&quot; deux instructions. En OCaml, toutes les
fonctions peuvent √™tre exprim√©es par :</p>
<pre><code class='tryocaml'>Characters 1:15 - 1:16 :
Error: Lexical error: don't know what to do with character '√'
</code></pre>
<p>
La d√©finition de ce qu&#39;est une expression en OCaml est juste un peu plus
large qu&#39;en C. En fait, C a un concept d&#39;&quot;instruction&quot; - mais toutes les
instructions du C sont des expressions en OCaml (combin√©es avec
l&#39;op√©rateur <code>;</code>).</p>
<p>Une diff√©rence entre <code>;</code> et <code>+</code> est que je peux utiliser <code>+</code> comme une
fonction. Par exemple, je peux d√©finir une fonction <code>sum_list</code> pour
calculer la somme d&#39;une liste d&#39;entier comme ceci :</p>
<pre><code class='tryocaml'><span class='keyword'>let</span> <span class='lower'>sum_list</span> <span class='keywordsign'>=</span> <span class='constructor module'>List</span><span class='keywordsign'>.</span><span class='lower'>fold_left</span> <span class='keywordsign'>(</span> <span class='keywordsign'>+</span> <span class='keywordsign'>)</span> <span class='number'>0</span>
</code></pre>
<h2 id="Toutescesnotionsensembleunexempledecoderel"> Toutes ces notions ensemble : un exemple de code r√©el</h2><p>

Dans cette section nous allons regarder quelques fragments de vrai code
pris dans la biblioth√®que lablgtk 1.2. (Lablgtk est la biblioth√®que
OCaml d&#39;interfa√ßage avec la biblioth√®que de widgets Gtk, native sous
Unix). Un avertissement : ces fragments utilisent beaucoup de concepts
que nous n&#39;avons pas encore abord√©. Ne vous arr√™tez pas sur les d√©tails,
regardez plut√¥t la forme g√©n√©rale du code, comment les auteurs ont
utilis√© <code>;;</code>, o√π ils ont utilis√© <code>;</code> et o√π ils ont utilis√© <code>open</code>,
comment ils ont indent√© le code, et utilis√© des expressions nomm√©es
locales ou globales.</p>
<p>... Je vais quand m√™me vous donner quelques indices pour que vous ne
soyez pas totalement perdus !</p>
<ul>
 <li><code>?foo</code> et <code>~foo</code> est la fa√ßon de passer des param√®tres optionels et
 nomm√©s en OCaml. Il n&#39;y a pas vraiment d&#39;√©quivalent dans les
 langages de la famille de C, mais Perl, Python et Smalltalk
 permettent tous de nommer les arguments d&#39;un appel de fonction, en
 oublier certains, et fournir les autres dans n&#39;importe quel ordre.
 </li>
 <li><code>foo#bar</code> est un appel de m√©thode (appel de la m√©thode nomm√©e <code>bar</code>
 de l&#39;objet nomm√© <code>foo</code>). C&#39;est l&#39;√©quivalent de <code>foo-&gt;bar</code>, ou
 <code>foo.bar</code> ou <code>$foo-&gt;bar</code> en C++, Java et Perl, respectivement.</li>
</ul>

<p>Premier fragment : Le programmeur ouvre une paire de modules standards
(en omettant le <code>;;</code> parce que les mots cl√©s suivants sont <code>open</code> et
<code>let</code>, respectivement). Il cr√©e ensuite une fonction nomm√©e
<code>file_dialog</code>. Dans cette fonction il d√©finit une expression nomm√©e
appel√©e <code>sel</code> en utilisant une instruction <code>let sel = ... in</code> de deux
lignes. Puis il appelle plusieurs m√©thodes de <code>sel</code>.</p>
<pre><code class='tryocaml'><span class='comment'>(* First snippet *)</span>

<span class='keyword'>open</span> <span class='constructor module'>StdLabels</span>
<span class='keyword'>open</span> <span class='constructor module'>GMain</span>

<span class='keyword'>let</span> <span class='lower'>file_dialog</span> <span class='keywordsign'>~</span><span class='lower'>title</span> <span class='keywordsign'>~</span><span class='lower'>callback</span> <span class='keywordsign'>?</span><span class='lower'>filename</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span> <span class='keywordsign'>=</span>
  <span class='keyword'>let</span> <span class='lower'>sel</span> <span class='keywordsign'>=</span>
    <span class='constructor module'>GWindow</span><span class='keywordsign'>.</span><span class='lower'>file_selection</span> <span class='keywordsign'>~</span><span class='lower'>title</span> <span class='keywordsign'>~</span><span class='lower'>modal</span><span class='keywordsign'>:</span><span class='keyword'>true</span> <span class='keywordsign'>?</span><span class='lower'>filename</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span> <span class='keyword'>in</span>
  <span class='lower'>sel</span><span class='keywordsign'>#</span><span class='lower'>cancel_button</span><span class='keywordsign'>#</span><span class='lower'>connect</span><span class='keywordsign'>#</span><span class='lower'>clicked</span> <span class='keywordsign'>~</span><span class='lower'>callback</span><span class='keywordsign'>:</span><span class='lower'>sel</span><span class='keywordsign'>#</span><span class='lower'>destroy</span><span class='keywordsign'>;</span>
  <span class='lower'>sel</span><span class='keywordsign'>#</span><span class='lower'>ok_button</span><span class='keywordsign'>#</span><span class='lower'>connect</span><span class='keywordsign'>#</span><span class='lower'>clicked</span> <span class='keywordsign'>~</span><span class='lower'>callback</span><span class='keywordsign'>:</span><span class='lower'>do_ok</span><span class='keywordsign'>;</span>
  <span class='lower'>sel</span><span class='keywordsign'>#</span><span class='lower'>show</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span>
</code></pre>
<p>
Deuxi√®me fragment : Juste une longue liste de d√©finitions au niveau
global. Remarquez que l&#39;auteur a omis toutes les occurrences de <code>;;</code>
gr√¢ce √† la r√®gle n¬∞2.</p>
<pre><code class='tryocaml'><span class='comment'>(* Second snippet *)</span>

<span class='keyword'>let</span> <span class='lower'>window</span> <span class='keywordsign'>=</span> <span class='constructor module'>GWindow</span><span class='keywordsign'>.</span><span class='lower'>window</span> <span class='keywordsign'>~</span><span class='lower'>width</span><span class='keywordsign'>:</span><span class='number'>500</span> <span class='keywordsign'>~</span><span class='lower'>height</span><span class='keywordsign'>:</span><span class='number'>300</span> <span class='keywordsign'>~</span><span class='lower'>title</span><span class='keywordsign'>:</span><span class='string'>&#34;editor&#34;</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span>
<span class='keyword'>let</span> <span class='lower'>vbox</span> <span class='keywordsign'>=</span> <span class='constructor module'>GPack</span><span class='keywordsign'>.</span><span class='lower'>vbox</span> <span class='keywordsign'>~</span><span class='lower'>packing</span><span class='keywordsign'>:</span><span class='lower'>window</span><span class='keywordsign'>#</span><span class='lower'>add</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span>

<span class='keyword'>let</span> <span class='lower'>menubar</span> <span class='keywordsign'>=</span> <span class='constructor module'>GMenu</span><span class='keywordsign'>.</span><span class='lower'>menu_bar</span> <span class='keywordsign'>~</span><span class='lower'>packing</span><span class='keywordsign'>:</span><span class='lower'>vbox</span><span class='keywordsign'>#</span><span class='lower'>pack</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span>
<span class='keyword'>let</span> <span class='lower'>factory</span> <span class='keywordsign'>=</span> <span class='keyword'>new</span> <span class='constructor module'>GMenu</span><span class='keywordsign'>.</span><span class='lower'>factory</span> <span class='lower'>menubar</span>
<span class='keyword'>let</span> <span class='lower'>accel_group</span> <span class='keywordsign'>=</span> <span class='lower'>factory</span><span class='keywordsign'>#</span><span class='lower'>accel_group</span>
<span class='keyword'>let</span> <span class='lower'>file_menu</span> <span class='keywordsign'>=</span> <span class='lower'>factory</span><span class='keywordsign'>#</span><span class='lower'>add_submenu</span> <span class='string'>&#34;File&#34;</span>
<span class='keyword'>let</span> <span class='lower'>edit_menu</span> <span class='keywordsign'>=</span> <span class='lower'>factory</span><span class='keywordsign'>#</span><span class='lower'>add_submenu</span> <span class='string'>&#34;Edit&#34;</span>

<span class='keyword'>let</span> <span class='lower'>hbox</span> <span class='keywordsign'>=</span> <span class='constructor module'>GPack</span><span class='keywordsign'>.</span><span class='lower'>hbox</span> <span class='keywordsign'>~</span><span class='lower'>packing</span><span class='keywordsign'>:</span><span class='lower'>vbox</span><span class='keywordsign'>#</span><span class='lower'>add</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span>
<span class='keyword'>let</span> <span class='lower'>editor</span> <span class='keywordsign'>=</span> <span class='keyword'>new</span> <span class='lower'>editor</span> <span class='keywordsign'>~</span><span class='lower'>packing</span><span class='keywordsign'>:</span><span class='lower'>hbox</span><span class='keywordsign'>#</span><span class='lower'>add</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span>
<span class='keyword'>let</span> <span class='lower'>scrollbar</span> <span class='keywordsign'>=</span> <span class='constructor module'>GRange</span><span class='keywordsign'>.</span><span class='lower'>scrollbar</span> <span class='keywordsign'>`</span><span class='constructor module'>VERTICAL</span> <span class='keywordsign'>~</span><span class='lower'>packing</span><span class='keywordsign'>:</span><span class='lower'>hbox</span><span class='keywordsign'>#</span><span class='lower'>pack</span> <span class='keywordsign'>(</span><span class='keywordsign'>)</span>
</code></pre>
<p>
Troisi√®me fragment : L&#39;auteur importe tous les symboles du module
<code>GdkKeysyms</code>. Puis nous avons un let-binding inhabituel.
<code>let _ = expression</code> signifie &quot;√©value la valeur de expression (avec tous
les effets de bords que cela comporte), puis jette le r√©sultat&quot;. En
l&#39;occurrence, &quot;calcule la valeur de l&#39;expression&quot; signifie ex√©cuter
<code>Main.main ()</code> qui est la boucle principale de Gtk, qui a pour effet de
bord d&#39;ouvrir la fen√™tre de l&#39;application √† l&#39;√©cran. Le &quot;r√©sultat&quot; de
<code>Main.main ()</code> est sans importance - probablement la valeur <code>unit</code>, mais
je n&#39;ai pas v√©rifi√© - et elle n&#39;est retourn√©e que quand l&#39;application
est en train de se terminer.</p>
<p>Remarquez que dans ce fragment nous avons de longues successions de
commandes proc√©durales. C&#39;est un programme imp√©ratif classique.</p>
<pre><code class='tryocaml'>Characters 8:33 - 8:35 :
Error: Lexical error while reading an operator
</code></pre>

      </div>
    </div>
  </div>
</div>

    <footer id="footer" class="navbar navbar-inverse navbar-fixed-bottom">
      <div class="navbar-inner">
        <div class="container-fluid">
          <ul class="nav pull-left">
            <li><a style='cursor:pointer;' onclick="document.getElementById('footer').style.display='none'">[X]</a></li>

            <li><a href="https://github.com/ocamllabs/sandbox-ocaml.org/tree/master/md-pages/learn/tutorials/structure_of_ocaml_programs.fr.md">Edit this page</a></li>
          </ul>
          <ul class="nav pull-right">
            <li><a href="https://github.com/ocamllabs/sandbox-ocaml.org/issues">Feedback</a></li>
            <li><a href="https://github.com/ocamllabs/sandbox-ocaml.org/issues">Contact us</a></li>
            <li><a href="https://github.com/ocamllabs/sandbox-ocaml.org/">Find us on GitHub</a></li>
          </ul>
        </div>
      </div>
    </footer>
    <!-- Load javascript from CDN -->
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
    <script type="text/javascript">
      // <!--
      if(document.getElementsByTagName('pre').length > 0)
         octry('')
      // -->
    </script>
  </body>
</html>
