<!DOCTYPE HTML>

<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title> &ndash; OCaml</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Google Web Fonts -->
    <link href="http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Domine:400,700" rel="stylesheet">
    <!-- Only part of Bootstrap that we don't load from a CDN is our own customized CSS build. -->
    <link href="/static/css/bootstrap.css" rel="stylesheet" media="screen">
    <!--[if lt IE 9]>
        <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
    <![endif]-->
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="/"><img src="/static/img/ocaml.png" alt="OCaml"></a>
          <div class="nav-collapse collapse">
                        <ul class="nav">
              <li ><a href="/learn/">Learn</a></li>
              <li ><a href="/docs/">Documentation</a></li>
              <li ><a href="/platform/">Platform</a></li>
              <li ><a href="/list.html">Packages</a></li>
              <li ><a href="/community/">Community</a></li>
            </ul>

            <form class="navbar-search pull-right">
              <input class="search-query" type="text" placeholder="Search" />
            </form>
          </div>
        </div>
      </div>
    </nav>
    
        <div class="container">
      <div class="row">

        <div id="content-primary" class="span8">
          <div class="content">
            <p><em>Table des matières</em></p>
<h1 id="UtiliserlemoduleFormat"> Utiliser le module Format</h1><p>
Le module Format des librairies standard de Caml Light et OCaml propose
une méthode d&#39;impression enjolivée. Ce module implémente un moteur
d&#39;impression qui coupe « bien » les lignes (« bien » signifie à-peu-près
ici « automatiquement et quand nécessaire »).</p>
<h2 id="Principes"> Principes</h2><p>
La coupure des lignes repose sur trois concepts:</p>
<ul>
 <li><strong>Les boîtes</strong> : une boîte est une unité logique d&#39;impression, qui
 définit un comportement du moteur d&#39;impression pour présenter
 l&#39;intérieur de la boîte.
 </li>
 <li><strong>Les indications de coupures</strong> : une indication de coupure est une
 directive au moteur d&#39;impression, qui lui propose de couper la ligne
 à cet endroit si cela s&#39;avère nécessaire. Sinon, le moteur
 d&#39;impression ne coupe jamais les lignes (sauf en « cas d&#39;urgence »
 pour éviter les trop mauvaises sorties).
 </li>
 <li><strong>Les règles d&#39;indentation</strong> : Quand le moteur d&#39;impression démarre
 une nouvelle ligne, il fixe l&#39;indentation de la nouvelle ligne
 (c&#39;est-à-dire le nombre de blancs insérés en début de ligne) en
 suivant des règles qui dépendent à la fois de l&#39;indication de
 coupure et de la définition de la boîte où la ligne est coupée :
  <ul>
   <li>Une boîte peut définir le montant de l&#39;indentation ajoutée à
 chaque nouvelle ligne de son corps. Cette valeur est appelée
 <strong>indentation additionnelle de boîte</strong>.
   </li>
   <li>Une indication de coupure peut aussi définir une indentation
 additionelle pour la nouvelle ligne qu&#39;elle peut occasionner.
 Cette valeur est appelée <strong>indentation additionnelle de
 coupure</strong>.
   </li>
   <li>Si l&#39;indication de coupure <code>bh</code> engendre une nouvelle ligne à
 l&#39;intérieur de la boîte <code>b</code>, alors l&#39;indentation de la nouvelle
 ligne est la somme de: l&#39;indentation courante de la boîte <code>b</code>
 <code>+</code> l&#39;indentation additionnelle de boîte définie par la boîte
 <code>b</code> <code>+</code> l&#39;indication additionnelle de coupure définie par
 l&#39;indication de coupure <code>bh</code>.</li>
  </ul>
 </li>
</ul>

<h2 id="Lesbotes"> Les boîtes</h2><p>
Il y a 4 types de boîtes. (La plus communément utilisée est la boîte «
hov », laissez tomber les autres types en première lecture.)</p>
<ul>
 <li><strong>Boîte horizontale</strong> (boîte <em>h</em>, ouverte par la procédure
 <code>open_hbox</code>) : dans cette boîte les indications de coupures ne
 donnent pas lieu à retour à la ligne.
 </li>
 <li><strong>Boîte verticale</strong> (boîte <em>v</em>, ouverte par la procédure
 <code>open_vbox</code>): toute indication de coupure provoque un retour à la
 ligne.
 </li>
 <li><strong>Boîte verticale/horizontale</strong> (boîte <em>hv</em>, ouverte par la
 procédure <code>open_hvbox</code>) : si c&#39;est possible, toute la boîte est
 imprimée sur une seule ligne; sinon toute indication de coupure
 provoque un retour à la ligne.
 </li>
 <li><strong>Boîte verticale ou horizontale</strong> (boîte <em>hov</em>, ouverte par l&#39;une
 des procédures <code>open_box</code> ou <code>open_hovbox</code>) ou boîte « tassante »:
 les indications de coupure sont utilisées pour aller à la ligne
 quand il n&#39;y a plus de place sur la ligne courante. Il existe deux
 espèces légèrement différentes de boîtes « hov » qui sont décrites
 <a href='#hov-boxes'>plus bas</a>. En première approximation nous confondrons
 ces deux types de boîtes « hov » et ne considérerons que celles
 obtenues avec la procédure <code>open_box</code>.</li>
</ul>

<p>Donnons un exemple. Supposons que nous voulions écrire 10 caractères
avant la marge droite (qui indique qu&#39;il n&#39;y a plus de place sur la
ligne courante). Je représente chaque caractère par une marque <code>-</code>, les
ouvertures et fermetures de boîtes sont indiquées respectivement par <code>[</code>
et <code>]</code>, et <code>b</code> signifie une indication de coupure (blanc ou « break »).</p>
<p>La sortie &quot;--b--b--&quot; est imprimée comme suit (le symbole b vaut la
valeur de la coupure comme expliqué ci-après) :</p>
<ul>
 <li>dans une boîte « h » :</li>
</ul>

<pre><code class='ocaml'><script>ml8d5cb61c0deb32ee4f4bede40955a7e4 = '   --b--b--\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>   <span class='o'>--</span>b<span class='o'>--</span>b<span class='o'>--</span>
</code></pre>
<ul>
 <li>dans une boîte « v » :</li>
</ul>

<pre><code class='ocaml'><script>mlc8d0f256d2781694ca6c0680bc6684d8 = '   --b\n   --b\n   --\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>   <span class='o'>--</span>b
   <span class='o'>--</span>b
   <span class='o'>--</span>
</code></pre>
<ul>
 <li>dans une boîte « hv » :</li>
</ul>

<p>S&#39;il y a assez de place pour imprimer toute la boîte sur la ligne :</p>
<pre><code class='ocaml'><script>ml8d5cb61c0deb32ee4f4bede40955a7e4 = '   --b--b--\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>   <span class='o'>--</span>b<span class='o'>--</span>b<span class='o'>--</span>
</code></pre>
<p>
Mais si &quot;---b---b---&quot; ne peut tenir sur la ligne, la sortie est</p>
<pre><code class='ocaml'><script>mlfd8b62518dbd6ac730c9aeb586a71f17 = '   ---b\n   ---b\n   ---\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>   <span class='o'>---</span>b
   <span class='o'>---</span>b
   <span class='o'>---</span>
</code></pre>
<ul>
 <li>dans une boîte « hov » :</li>
</ul>

<p>S&#39;il y a assez de place pour imprimer toute la boîte sur la ligne :</p>
<pre><code class='ocaml'><script>ml8d5cb61c0deb32ee4f4bede40955a7e4 = '   --b--b--\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>   <span class='o'>--</span>b<span class='o'>--</span>b<span class='o'>--</span>
</code></pre>
<p>
Mais si &quot;---b---b---&quot; ne peut tenir sur la ligne, la sortie est</p>
<pre><code class='ocaml'><script>ml69a5fd4512fc98e75eeedf134ade34cf = '   ---b---b\n   ---\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>   <span class='o'>---</span>b<span class='o'>---</span>b
   <span class='o'>---</span>
</code></pre>
<p>
La première indication de coupure ne donne pas lieu à un retour à la
ligne, puisque la ligne n&#39;est pas pleine. La seconde indication de
coupure entraîne un retour à la ligne, puisqu&#39;il n&#39;y a plus la place
d&#39;imprimer ce qui suit l&#39;indication de coupure. Si la place restante
sur la ligne était encore plus courte, la première indication de
coupure aurait aussi donné lieu à un retour à la ligne et
&quot;---b---b---&quot; aurait été imprimé ainsi:</p>
<pre><code class='ocaml'><script>mld30bd610a9962987fe5ab2e4ddedb150 = '    ---b\n    ---b\n    ---\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>    <span class='o'>---</span>b
    <span class='o'>---</span>b
    <span class='o'>---</span>
</code></pre>
<h2 id="Impressiondesespaces"> Impression des espaces</h2><p>
Les indications de coupure sont aussi utilisées pour imprimer des
espaces (si la ligne n&#39;est pas coupée quand l&#39;indication de coupure est
traitée, sinon le retour à la ligne sépare correctement les éléments à
imprimer). Vous donnez une indication de coupure en appelant
<code>print_break sp indent</code>, où <code>sp</code> est l&#39;entier qui indique le nombre
d&#39;espaces à imprimer.<br />.boîte la dans 
ouverte ligne chaque à ajoutée indentation&#39;l fixer peut on boîte, la 
de ouverture&#39;l à :<strong>apparaît ligne la où boîte la définissant En</strong> *</p>
<p>: lignes des indentation&#39;l fixer de moyens deux de dispose On
nouvelles lignes des Indentation ##</p>
<p>).ligne de coupure une déclenche ou espace un écrit
et <code>0 1     break_print</code> de synonyme est qui <code>)( space_print</code> de aide&#39;l
à exemple Par( .coupure de indications des émet mais même-lui espaces&#39;d
pas écrit&#39;n ,<code>format</code> utilise qui programme un générale, façon De</p>
<p>.» hov « boîtes les pour même de et *</p>
<pre><code>--   
--   
--   
ocaml</code></pre>
<p>: ligne la sur restante place la suivant ou,</p>
<pre><code>-- -- --   
ocaml</code></pre>
<p>: » hv « boîte une dans *</p>
<pre><code>--   
--   
--   
ocaml</code></pre>
<p>: » v « boîte une dans *</p>
<pre><code>-- -- --   
ocaml</code></pre>
<p>: » h « boîte une dans *</p>
<p>: suivante
sortie la obtient on ,)espace un&#39;d impression&#39;l à correspond qui ce
,<code>0 1 break_print</code> est <code>b</code> où( &quot;--b--b--&quot; imprime on&#39;l si exemple, Par</p>
<p>.ligne
la à aller ou espaces <code>sp</code> imprimer signifie <code>... sp break_print</code> Donc 
<br />
 Par exemple: <code>open_hovbox 1</code> ouvre une boîte hovbox dont les lignes
 seront indentées de 1 par rapport à l&#39;indentation initiale de la
 boîte. Ainsi avec &quot;---[--b--b--b--&quot;, on obtient :</p>
<pre><code class='ocaml'><script>ml4d7027ea062eb32be5722b51bdf2feb7 = '   ---[--b--b\n        --b--\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>   <span class='o'>---</span><span class='o'>[</span><span class='o'>--</span>b<span class='o'>--</span>b
        <span class='o'>--</span>b<span class='o'>--</span>
</code></pre>
<p>
tandis qu&#39;avec <code>open_hovbox 2</code>, on obtient :</p>
<pre><code class='ocaml'><script>ml04fc84d21419c57b22908edef31bcee7 = '   ---[--b--b\n         --b--\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>   <span class='o'>---</span><span class='o'>[</span><span class='o'>--</span>b<span class='o'>--</span>b
         <span class='o'>--</span>b<span class='o'>--</span>
</code></pre>
<p>
Note: le symbole <code>[</code> n&#39;est évidemment pas visible sur la sortie
écran, je l&#39;écris pour matérialiser l&#39;ouverture de la boîte
d&#39;impression. Ainsi le dernier « écran » est en fait :</p>
<pre><code class='ocaml'><script>ml6c01e8716f1fd889f220d84a0fb40954 = '    -----b--b\n         --b--\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>    <span class='o'>-----</span>b<span class='o'>--</span>b
         <span class='o'>--</span>b<span class='o'>--</span>
</code></pre>
<ul>
 <li>En définissant l&#39;indication de coupure qui a provoqué le retour à la
 ligne. On émet une indication de coupure avec
 <code>print_break sp indent</code>. L&#39;entier <code>indent</code> fixe l&#39;indentation
 additionnelle de la nouvelle ligne qui peut être émise par
 l&#39;indication de coupure. C&#39;est-à-dire que <code>indent</code> est ajouté à
 l&#39;indentation par défaut de la boîte où la coupure a lieu.<br />
 Par exemple, en indiquant par <code>[</code> l&#39;ouverture d&#39;une boîte <code>hov 1</code>
 (obtenue par <code>open_hovbox       1</code>), et par <code>b</code>
 <code>print_break       1       2</code>, alors la sortie de &quot;---[--b--b--b--&quot;,
 sera imprimée :</li>
</ul>

<pre><code class='ocaml'><script>ml5056d79926449a43d89834ecb8a8d619 = '   ---[-- --\n         --\n         --\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>   <span class='o'>---</span><span class='o'>[</span><span class='o'>--</span> <span class='o'>--</span>
         <span class='o'>--</span>
         <span class='o'>--</span>
</code></pre>
<h2 id="Raffinementsurlesboteshov"> Raffinement sur les boîtes « hov »</h2><h3 id="Botehovtassanteetbotehovstructurelle"> Boîte « hov » tassante et boîte « hov » structurelle</h3><p>

Les boîtes « hov » se subdivisent en deux catégories au comportement
légèrement différent en ce qui concerne les coupures qui interviennent
après la fermeture d&#39;une boîte dont l&#39;indentation est différente de la
boîte qui l&#39;englobe. On distingue :</p>
<ul>
 <li>**la boîte « hov » *tassante*** (ouverte par la procédure
 <code>open_hovbox</code>): les indications de coupure sont utilisées pour aller
 à la ligne quand il n&#39;y a plus de place sur la ligne courante; il
 n&#39;y a pas de passage à la ligne s&#39;il y a assez de place sur la ligne
 courante.
 </li>
 <li>**la boîte « hov » *structurelle*** (ouverte par la procédure
 <code>open_box</code>): très similaire à la boîte « hov » tassante, les
 indications de coupure sont également utilisées pour aller à la
 ligne quand il n&#39;y a plus de place sur la ligne courante, mais de
 surcroît les indications de coupures qui permettent de mettre en
 évidence la structure de boîtes sont effectuées même s&#39;il reste
 assez de place sur la ligne courante.</li>
</ul>

<h3 id="Diffrencesentrebotehovtassanteetbotehovstructurelle"> Différences entre boîte « hov » tassante et boîte « hov » structurelle</h3><p>
La différence de comportement entre la boîte « hov » tassante et la
boîte « hov » structurelle (ou « box ») est mise en évidence par la
fermeture des boîtes et la fermeture des parenthèses en fin
d&#39;impression: avec la boîte « hov » tassante les boîtes et les
parenthèses sont fermées sur la même ligne (si la place disponible le
permet), tandis qu&#39;avec la boîte « hov » structurelle chaque indication
de coupure produira un saut de ligne. Prenons l&#39;exemple de la sortie de
&quot;[(---[(----[(---b)]b)]b)]&quot; où &quot;b&quot; représente une indication de coupure
sans indentation supplémentaire (<code>print_cut     ()</code>). Ainsi, si &quot;[&quot;
représente l&#39;ouverture de boîtes « hov » tassantes (<code>open_hovbox</code>),
&quot;[(---[(----[(---b)]b)]b)]&quot; est imprimé ainsi:</p>
<pre><code class='ocaml'><script>mlc8b4a2aba4322490d09c3dc74a79871a = '(---\n (----\n  (---)))\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span><span class='o'>(---</span>
 <span class='o'>(----</span>
  <span class='o'>(---</span>)))
</code></pre>
<p>
Si maintenant on remplace les boîtes « hov » tassantes par des boîtes «
hov » structurelles (<code>open_box</code>), chaque indication de coupure placée
avant chaque parenthèse fermante est susceptible de montrer la structure
de boîte et produit donc une coupure; on obtient alors :</p>
<pre><code class='ocaml'><script>mla119c106352dfb2f0a397bc4de4d371e = '(---\n (----\n  (---\n  )\n )\n)\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span><span class='o'>(---</span>
 <span class='o'>(----</span>
  <span class='o'>(---</span>
  )
 )
)
</code></pre>
<h2 id="Conseilspratiques"> Conseils pratiques</h2><p>

En écrivant vos fonctions d&#39;impression, suivez les règles simples
suivantes :</p>
<ol>
 <li>Les boîtes doivent être ouvertes et fermées de façon cohérente (les
 appels à <code>open_*</code> et à <code>close_box</code> doivent être parenthésés).
 </li>
 <li>N&#39;hésitez pas à ouvrir des boîtes.
 </li>
 <li>Donnez beaucoup d&#39;indications de coupures, sinon l&#39;imprimeur se
 retrouve dans une situation anormale (coincé sur la marge droite),
 où il essaie de faire de son mieux, ce qui n&#39;est pas toujours très
 bon.
 </li>
 <li>N&#39;essayez pas de forcer l&#39;espacement à l&#39;aide de blancs explicites
 dans les chaînes de caractères à imprimer. Pour chaque espace
 nécessaire, utilisez une indication de coupure (<code>print_space ()</code>), à
 moins que vous ne vouliez pas que la ligne soit coupée à cet
 endroit. Par exemple, imaginez que vous vouliez imprimer une
 définition OCaml, disons <code>let rec ident = expression</code>. Vous allez
 probablement considérer les 3 premiers blancs comme des « blancs
 insécables » et les inclure directement dans une chaîne de
 caractères, et écrire la chaîne <code>&quot;let rec &quot;</code> avant l&#39;identificateur
 et la chaîne <code> =</code> après lui; en revanche, l&#39;espace qui suit le
 caractère <code>=</code> doit être une indication de coupure, puisqu&#39;il est
 d&#39;usage (et élégant) de couper la ligne à cet endroit pour indenter
 la partie expression d&#39;une définition. En conclusion, il est bien
 sûr souvent nécessaire d&#39;imprimer des caractères « espace », ou
 blancs insécables, mais la plupart du temps un espace correspond
 plutôt à une indication de coupure.)
 </li>
 <li>Ne forcez jamais de coupures de ligne, laissez le moteur
 d&#39;impression le faire pour vous: c&#39;est son travail! En particulier,
 n&#39;utilisez pas la procédure <code>force_newline</code>: son usage provoque bien
 une coupure de ligne, mais il provoque aussi une réinitialisation
 partielle du moteur d&#39;impression qui déséquilibre tout le reste de
 l&#39;impression.
 </li>
 <li>N&#39;imprimez jamais de retour à la ligne dans les chaînes de
 caractères : le moteur d&#39;impression considèrera à juste titre ce
 retour chariot comme un caractère quelconque émis sur la ligne
 courante, ce qui dérangera complètement la sortie. Utilisez à la
 place des coupures de ligne: si celles-ci doivent se produire à tout
 coup, c&#39;est que la boîte englobante doit être une boîte verticale!
 </li>
 <li>Terminez votre programme principal d&#39;impression par un appel à
 <code>print_newline ()</code>, qui vide les tables de l&#39;imprimeur (et donc
 termine l&#39;impression). (Notez que le système interactif le fait
 également à la fin de chaque phrase entrée.)</li>
</ol>

<h2 id="Impressionsurlasortiestandardutilisationdeprintf"> Impression sur la sortie standard: utilisation de <code>printf</code></h2><p>
Le module <code>format</code> vous propose une fonction générale de formattage à la
<code>printf</code>. En plus des indications de format habituelles à la primitive
<code>printf</code>, on dispose dans le format de caractères qui commandent
ouvertures et fermetures de boîtes ainsi que l&#39;émission d&#39;indications de
coupure de ligne.</p>
<p>Les indications spécifiques au moteur d&#39;impression sont toutes
introduites par le caractère <code>@</code>. À peu près toutes les fonctions du
module <code>format</code> peuvent être appelées depuis un format de <code>printf</code>.
Ainsi :</p>
<ul>
 <li>« <code>@[</code> » ouvre une boîte (<code>open_box             0</code>). On peut
 préciser le type de la boîte en argument supplémentaire. Par exemple
 <code>@[&lt;hov n&gt;</code> est équivalent à <code>open_hovbox n</code>.
 </li>
 <li>« <code>@]</code> » ferme la dernière boîte ouverte (<code>close_box ()</code>).
 </li>
 <li>« <code>@</code> » émet un espace sécable (<code>print_space ()</code>).
 </li>
 <li>« <code>@,</code> » émet une indication de coupure sans espace ni indentation
 supplémentaire en cas de coupure (<code>print_cut ()</code>).
 </li>
 <li>« <code>@;&lt;n m&gt;</code> » émet une indication de coupure la plus générale, avec
 ses deux arguments entiers (<code>print_break n m</code>).
 </li>
 <li>« <code>@.</code> » termine l&#39;impression en fermant toutes les boîtes encore
 ouvertes (<code>print_newline ()</code>).</li>
</ul>

<p>Par exemple</p>
<pre><code class='ocaml'><script>mla7f5e7b7d76a661f4dbb8579dd2bd77f = 'printf &#34;@[&#60;1&#62;%s@ =@ %d@ %s@]@.&#34; &#34;Prix TTC&#34; 100 &#34;Euros&#34;;;\nPrix TTC = 100 Euros\n\n- : unit = ()\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>printf <span class='s'>&#34;@[&#60;1&#62;%s@ =@ %d@ %s@]@.&#34;</span> <span class='s'>&#34;Prix TTC&#34;</span> 100 <span class='s'>&#34;Euros&#34;</span><span class='o'>;;</span>
Prix TTC <span class='k'>=</span> 100 Euros

<span class='o'>-</span> <span class='o'>:</span> unit <span class='k'>=</span> ()
</code></pre>
<h2 id="Unexempleconcret"> Un exemple concret</h2><p>

Voici un exemple complet : le plus petit exemple non trivial qu&#39;on
puisse imaginer, c&#39;est-à-dire le \$\lambda-\$calculus :)</p>
<p>Le problème est donc d&#39;imprimer les valeurs d&#39;un type concret qui
modélise un langage d&#39;expressions qui définissent les fonctions et leur
application à des arguments.</p>
<p>D&#39;abord, je donne la syntaxe abstraite des lambda-termes (nous utilisons
le <a href='../description.html#interactive'>système interactif</a> pour évaluer ce
code) :</p>
<pre><code class='ocaml'><script>ml9086d339d24610088e3dfca6d70cdba8 = '  type lambda =\n    | Lambda of string * lambda\n    | Var of string\n    | Apply of lambda * lambda\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>  <span class='k'>type</span> lambda <span class='k'>=</span>
    <span class='o'>|</span> Lambda <span class='k'>of</span> string <span class='o'>*</span> lambda
    <span class='o'>|</span> Var <span class='k'>of</span> string
    <span class='o'>|</span> Apply <span class='k'>of</span> lambda <span class='o'>*</span> lambda
</code></pre>
<p>
J&#39;utilise le module format pour imprimer les lambda-termes:</p>
<pre><code class='ocaml'><script>mlcbbf238488d56f3906e3ad87408a731f = '  open Format;;\n\n  let ident = print_string\n  let kwd = print_string;;\n\n  let rec print_exp0 = function\n    | Var s -&#62;  ident s\n    | lam -&#62; open_hovbox 1; kwd &#34;(&#34;; print_lambda lam; kwd &#34;)&#34;; close_box ()\n  and print_app = function\n    | e -&#62; open_hovbox 2; print_other_applications e; close_box ()\n  and print_other_applications f =\n    match f with\n    | Apply (f, arg) -&#62; print_app f; print_space (); print_exp0 arg\n    | f -&#62; print_exp0 f\n  and print_lambda = function\n    | Lambda (s, lam) -&#62;\n        open_hovbox 1;\n        kwd &#34;\\&#34;; ident s; kwd &#34;.&#34;; print_space(); print_lambda lam;\n        close_box()\n    | e -&#62; print_app e\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>  <span class='k'>open</span> Format<span class='o'>;;</span>

  <span class='k'>let</span> ident <span class='k'>=</span> print_string
  <span class='k'>let</span> kwd <span class='k'>=</span> print_string<span class='o'>;;</span>

  <span class='k'>let rec</span> print_exp0 <span class='k'>=</span> <span class='k'>function</span>
    <span class='o'>|</span> Var s <span class='k'>-></span>  ident s
    <span class='o'>|</span> lam <span class='k'>-></span> open_hovbox 1<span class='o'>;</span> kwd <span class='s'>&#34;(&#34;</span><span class='o'>;</span> print_lambda lam<span class='o'>;</span> kwd <span class='s'>&#34;)&#34;</span><span class='o'>;</span> close_box ()
  <span class='k'>and</span> print_app <span class='k'>=</span> <span class='k'>function</span>
    <span class='o'>|</span> e <span class='k'>-></span> open_hovbox 2<span class='o'>;</span> print_other_applications e<span class='o'>;</span> close_box ()
  <span class='k'>and</span> print_other_applications f <span class='k'>=</span>
    <span class='k'>match</span> f <span class='k'>with</span>
    <span class='o'>|</span> Apply (f<span class='o'>,</span> arg) <span class='k'>-></span> print_app f<span class='o'>;</span> print_space ()<span class='o'>;</span> print_exp0 arg
    <span class='o'>|</span> f <span class='k'>-></span> print_exp0 f
  <span class='k'>and</span> print_lambda <span class='k'>=</span> <span class='k'>function</span>
    <span class='o'>|</span> Lambda (s<span class='o'>,</span> lam) <span class='k'>-></span>
        open_hovbox 1<span class='o'>;</span>
        kwd <span class='s'>&#34;\\&#34;; ident s; kwd &#34;</span><span class='o'>.</span>"<span class='o'>;</span> print_space()<span class='o'>;</span> print_lambda lam<span class='o'>;</span>
        close_box()
    <span class='o'>|</span> e <span class='k'>-></span> print_app e
</code></pre>
<p>
En Caml Light, remplacez la première ligne par :</p>
<pre><code class='ocaml'><script>ml77efcf2f84331048edcca85ad70369bb = '#open &#34;format&#34;;;\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span><span class='o'>#</span><span class='k'>open</span> <span class='s'>&#34;format&#34;</span><span class='o'>;;</span>
</code></pre>
<h3 id="Impressionlaplusgnraleutilisationdefprintf"> Impression la plus générale: utilisation de <code>fprintf</code></h3><p>

On utilise maintenant la fonction <code>fprintf</code> et toutes les fonctions
d&#39;impression prennent en argument supplémentaire le formatteur (c&#39;est
l&#39;argument <code>ppf</code>) où l&#39;impression se produira. Cela généralise les
fonctions d&#39;impression qui peuvent maintenant imprimer sur n&#39;importe
quel formateur défini dans le programme, et cela permet en outre
d&#39;utiliser la conversion <code>%a</code>, celle qu&#39;on utilise pour imprimer un
argument de <code>fprintf</code> avec une fonction d&#39;impression spécialisée qu&#39;on a
préalablement définie dans le programme (ces fonctions d&#39;impression de
l&#39;utilisateur prennent aussi un formatteur en premier argument).</p>
<p>Voici la fonction d&#39;impression des lambda-termes à l&#39;aide des formats
d&#39;impression à la <code>fprintf</code>.</p>
<pre><code class='ocaml'><script>mle0902c96a7ca47b3f2c6762b4f57e1ca = '  open Format;;\n\n  let ident ppf s = fprintf ppf &#34;%s&#34; s\n  let kwd ppf s = fprintf ppf &#34;%s&#34; s;;\n\n  let rec pr_exp0 ppf = function\n    | Var s -&#62; fprintf ppf &#34;%a&#34; ident s\n    | lam -&#62; fprintf ppf &#34;@[&#60;1&#62;(%a)@]&#34; pr_lambda lam\n  and pr_app ppf e =\n    fprintf ppf &#34;@[&#60;2&#62;%a@]&#34; pr_other_applications e\n  and pr_other_applications ppf f =\n    match f with\n    | Apply (f, arg) -&#62; fprintf ppf &#34;%a@ %a&#34; pr_app f pr_exp0 arg\n    | f -&#62; pr_exp0 ppf f\n  and pr_lambda ppf = function\n    | Lambda (s, lam) -&#62;\n       fprintf ppf &#34;@[&#60;1&#62;%a%a%a@ %a@]&#34;\n               kwd &#34;\\&#34; ident s kwd &#34;.&#34; pr_lambda lam\n    | e -&#62; pr_app ppf e\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>  <span class='k'>open</span> Format<span class='o'>;;</span>

  <span class='k'>let</span> ident ppf s <span class='k'>=</span> fprintf ppf <span class='s'>&#34;%s&#34;</span> s
  <span class='k'>let</span> kwd ppf s <span class='k'>=</span> fprintf ppf <span class='s'>&#34;%s&#34;</span> s<span class='o'>;;</span>

  <span class='k'>let rec</span> pr_exp0 ppf <span class='k'>=</span> <span class='k'>function</span>
    <span class='o'>|</span> Var s <span class='k'>-></span> fprintf ppf <span class='s'>&#34;%a&#34;</span> ident s
    <span class='o'>|</span> lam <span class='k'>-></span> fprintf ppf <span class='s'>&#34;@[&#60;1&#62;(%a)@]&#34;</span> pr_lambda lam
  <span class='k'>and</span> pr_app ppf e <span class='k'>=</span>
    fprintf ppf <span class='s'>&#34;@[&#60;2&#62;%a@]&#34;</span> pr_other_applications e
  <span class='k'>and</span> pr_other_applications ppf f <span class='k'>=</span>
    <span class='k'>match</span> f <span class='k'>with</span>
    <span class='o'>|</span> Apply (f<span class='o'>,</span> arg) <span class='k'>-></span> fprintf ppf <span class='s'>&#34;%a@ %a&#34;</span> pr_app f pr_exp0 arg
    <span class='o'>|</span> f <span class='k'>-></span> pr_exp0 ppf f
  <span class='k'>and</span> pr_lambda ppf <span class='k'>=</span> <span class='k'>function</span>
    <span class='o'>|</span> Lambda (s<span class='o'>,</span> lam) <span class='k'>-></span>
       fprintf ppf <span class='s'>&#34;@[&#60;1&#62;%a%a%a@ %a@]&#34;</span>
               kwd <span class='s'>&#34;\\&#34; ident s kwd &#34;</span><span class='o'>.</span>" pr_lambda lam
    <span class='o'>|</span> e <span class='k'>-></span> pr_app ppf e
</code></pre>
<p>
Armés de ces fonctions d&#39;impression générales, les procédures
d&#39;impression sur la sortie standard ou la sortie d&#39;erreur s&#39;obtiennent
facilement par application partielle:.</p>
<pre><code class='ocaml'><script>ml5ad0be71e71d04ac2d16ffa35e13f0fc = '  let print_lambda = pr_lambda std_formatter\n  let eprint_lambda = pr_lambda err_formatter\n\n'; function copytoclipboard(s){}</script><span style='position:relative;top:-1em;'><span onclick='alert("not yet implemented")'>[try]</span><span onclick='alert("not yet implemented")'>[copy]</span><span onclick='alert("not yet implemented")'>[github]</span></span>  <span class='k'>let</span> print_lambda <span class='k'>=</span> pr_lambda std_formatter
  <span class='k'>let</span> eprint_lambda <span class='k'>=</span> pr_lambda err_formatter

</code></pre>

          </div>
        </div>
      </div>
    </div>
    <footer id="footer" class="navbar navbar-inverse navbar-fixed-bottom">
      <div class="navbar-inner">
        <div class="container-fluid">
          <ul class="nav pull-right">
            <li><a href="#">Feedback</a></li>
            <li><a href="#">Contact us</a></li>
            <li><a href="#">Find us on GitHub</a></li>
          </ul>
        </div>
      </div>
    </footer>
    <!-- Load javascript from CDN -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
  </body>
</html>
