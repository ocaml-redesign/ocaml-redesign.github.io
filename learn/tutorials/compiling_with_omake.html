<!DOCTYPE HTML>

<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title> &ndash; OCaml</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Google Web Fonts -->
    <link href="http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Domine:400,700" rel="stylesheet">
    <!-- Only part of Bootstrap that we don't load from a CDN is our own customized CSS build. -->
    <link href="/static/css/bootstrap.css" rel="stylesheet" media="screen">
    <!--[if lt IE 9]>
        <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
    <![endif]-->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <script type="text/javascript">
      function octry(x){
        if(document.getElementById('buttons').innerHTML=='') {
          t = document.getElementById('tryocaml');
          js = document.createElement("script"); js.type = "text/javascript"; js.src = "/try-ocaml.js";
          t.appendChild(js);
        } else {
          t = document.getElementById('tryocaml');
          t.style.display = 'block';
          document.getElementById('console').value = x;
          document.getElementById('console').focus();
          document.getElementById('console').select();
        }
      }
    </script>
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="/"><img src="/static/img/ocaml.png" alt="OCaml"></a>
          <div class="nav-collapse collapse">
                        <ul class="nav">
              <li ><a href="/learn/">Learn</a></li>
              <li ><a href="/docs/">Documentation</a></li>
              <li ><a href="/platform/">Platform</a></li>
              <li ><a href="/pkg/">Packages</a></li>
              <li ><a href="/community/">Community</a></li>
            </ul>

            <form class="navbar-search pull-right">
              <input class="search-query" type="text" placeholder="Search" />
            </form>
          </div>
        </div>
      </div>
    </nav>
    
        <div class="container">
      <div class="row">



          <div id='main-contents' class="content">
            <h1 id="CompilingwithOMake"> Compiling with OMake</h1><p>
Here is the summary on how to compile an OCaml program with
<a href='http://omake.metaprl.org/' title='OMake'>OMake</a>. It produces a native code
executable or a bytecode executable if ocamlopt is not available, using
ocamllex, ocamlyacc and regular ocaml files that use camlp4 syntax
libraries as well as regular libraries, all managed by
findlib/ocamlfind:</p>
<ol>
 <li>Do <code>omake --install</code>: it creates a template OMakefile and OMakeroot
 in the current directory. The OMakeroot file is left unchanged. The
 OMakefile template doesn&#39;t show options for using ocamlfind, so we
 will basically rewrite it, and grab some of the additional options
 that are shown in the file.
 </li>
 <li>Our source files are <code>parser.mly</code>, <code>lexer.mll</code> and <code>main.ml</code>. Delete
 or comment out the content of the automatically generated OMakefile,
 and put the following:</li>
</ol>

<!-- --><pre class='ocaml'><span class='o'>#</span> Program name (without extension)
PROGRAM <span class='k'>=</span> myprog

<span class='o'>#</span> Source files without extension<span class='o'>.</span> One item per line<span class='o'>,</span> no trailing spaces<span class='o'>.</span>
FILES<span class='o'>[</span><span class='o'>]</span> <span class='k'>=</span>
   parser
   lexer
   main
<span class='o'>#</span> Another syntax <span class='k'>for</span> the same thing<span class='o'>:</span>
<span class='o'>#</span> FILES <span class='k'>=</span> parser lexer <span class='o'>\</span>
<span class='o'>#</span>         main

<span class='o'>#</span> We use ocamlfind
USE_OCAMLFIND <span class='k'>=</span> <span class='o'>true</span>
<span class='o'>#</span> All ocamlfind packages that we use
OCAMLPACKS<span class='o'>[</span><span class='o'>]</span> <span class='k'>=</span>
   unix
   micmatch_pcre
   labltk
<span class='o'>#</span> We need <span class='k'>to</span> tell omake that we want camlp4 preprocessing
OCAMLFINDFLAGS <span class='k'>=</span> <span class='o'>-</span>syntax camlp4o

<span class='o'>#</span> We need <span class='k'>to</span> tell OMake that these files need <span class='k'>to</span> be created
<span class='o'>#</span> before it attempts <span class='k'>to</span> run ocamldep<span class='o'>.</span>
<span class='o'>#</span> (OMake knows that ocamllex <span class='k'>and</span> ocamlyacc should be used)
OCamlGeneratedFiles(lexer<span class='o'>.</span>ml parser<span class='o'>.</span>mli parser<span class='o'>.</span>ml)

<span class='o'>#</span> Compile into an executable
OCamlProgram<span class='o'>($</span>(PROGRAM)<span class='o'>,</span> <span class='o'>$</span>(FILES))

<span class='o'>#</span> Default target<span class='o'>:</span> compile into bytecode <span class='k'>or</span> native code<span class='o'>,</span> <span class='k'>or</span> both
<span class='o'>.</span>DEFAULT<span class='o'>:</span> <span class='o'>$</span>(<span class='k'>if</span> <span class='o'>$</span>(BYTE_ENABLED)<span class='o'>,</span> <span class='o'>$</span>(PROGRAM)<span class='o'>.</span>run) <span class='o'>\</span>
          <span class='o'>$</span>(<span class='k'>if</span> <span class='o'>$</span>(NATIVE_ENABLED)<span class='o'>,</span> <span class='o'>$</span>(PROGRAM)<span class='o'>.</span>opt)

<span class='o'>#</span> <span class='m'>Cleanup</span>
<span class='o'>.</span>PHONY<span class='o'>:</span> clean
clean<span class='o'>:</span>
  rm <span class='o'>-</span>f <span class='o'>\</span>
     <span class='o'>$</span>(filter<span class='o'>-</span>proper<span class='o'>-</span>targets <span class='o'>$</span>(glob <span class='o'>$</span>(addsuffix <span class='o'>.*</span><span class='o'>,</span> <span class='o'>$</span>(FILES)))) <span class='o'>\</span>
     <span class='o'>$</span>(PROGRAM)<span class='o'>.</span>run <span class='o'>$</span>(PROGRAM)<span class='o'>.</span>opt
<a href="javascript:octry('# Program name (without extension)\nPROGRAM = myprog\n\n# Source files without extension. One item per line, no trailing spaces.\nFILES[] =\n   parser\n   lexer\n   main\n# Another syntax for the same thing:\n# FILES = parser lexer \\n#         main\n\n# We use ocamlfind\nUSE_OCAMLFIND = true\n# All ocamlfind packages that we use\nOCAMLPACKS[] =\n   unix\n   micmatch_pcre\n   labltk\n# We need to tell omake that we want camlp4 preprocessing\nOCAMLFINDFLAGS = -syntax camlp4o\n\n# We need to tell OMake that these files need to be created\n# before it attempts to run ocamldep.\n# (OMake knows that ocamllex and ocamlyacc should be used)\nOCamlGeneratedFiles(lexer.ml parser.mli parser.ml)\n\n# Compile into an executable\nOCamlProgram($(PROGRAM), $(FILES))\n\n# Default target: compile into bytecode or native code, or both\n.DEFAULT: $(if $(BYTE_ENABLED), $(PROGRAM).run) \\n          $(if $(NATIVE_ENABLED), $(PROGRAM).opt)\n\n# Cleanup\n.PHONY: clean\nclean:\n  rm -f \\n     $(filter-proper-targets $(glob $(addsuffix .*, $(FILES)))) \\n     $(PROGRAM).run $(PROGRAM).opt\n');">[try]</a></pre>
<p>

Adapt your OMakefile to suit your needs in terms of source files, result
files, libraries and options. Now you can run omake, it should compile
an executable named either myprog.run (bytecode) or myprog.opt (native
code), or whatever you chose to call it. The omake clean command removes
files that were produced by the compilation.</p>
<p>Go to <a href='http://omake.metaprl.org/' title='OMake&#39;s official site'>OMake&#39;s official
site</a> for more
information.</p>

          </div>
        </div>
      </div>
    </div>
    <footer id="footer" class="navbar navbar-inverse navbar-fixed-bottom">
      <div class="navbar-inner">
        <div class="container-fluid">
          <ul class="nav pull-right">
            <li><a href="#">Feedback</a></li>
            <li><a href="#">Contact us</a></li>
            <li><a href="#">Find us on GitHub</a></li>
          </ul>
        </div>
      </div>
    </footer>
    <!-- Load javascript from CDN -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
    <script>
      if(document.getElementById('buttons')) octry('')
</script>
  </body>
</html>
