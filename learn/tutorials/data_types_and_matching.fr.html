<!DOCTYPE HTML>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title> &#8211; OCaml</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Google Web Fonts -->
    <link href="http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" />
    <link href="http://fonts.googleapis.com/css?family=Domine:400,700" rel="stylesheet" />
    <!-- Only part of Bootstrap that we don't load from a CDN is our own customized CSS build. -->
    <link href="/static/css/bootstrap.css" rel="stylesheet" media="screen" />
    <link href="/static/css/bootstrap_mod.css" rel="stylesheet" media="screen" />
    <link href="/static/css/opamdoc.css" rel="stylesheet" media="screen" />
    <!--[if lt IE 9]>
        <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
    <![endif]-->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <script type="text/javascript">
      function octry(x){
        if(document.getElementById('buttons').innerHTML=='') {
          t = document.getElementById('tryocaml');
          js = document.createElement("script"); js.type = "text/javascript"; js.src = "/try-ocaml.js";
          t.appendChild(js);
        } else {
          t = document.getElementById('tryocaml');
          t.style.display = 'block';
          document.getElementById('console').value = x;
          document.getElementById('console').focus();
          document.getElementById('console').select();
        }
      }
    </script>
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="/"><img src="/static/img/ocaml.png" alt="OCaml" /></a>
          <div class="nav-collapse collapse">
                        <ul class="nav">
              <li ><a href="/learn/">Learn</a></li>
              <li ><a href="/docs/">Documentation</a></li>
              <li ><a href="/platform/">Platform</a></li>
              <li ><a href="/pkg/">Packages</a></li>
              <li ><a href="/community/">Community</a></li>
            </ul>

            <form class="navbar-search pull-right">
              <input class="search-query" type="text" placeholder="Search" />
            </form>
          </div>
        </div>
      </div>
    </nav>
    
    <div class="container">
  <div class="row">
    

    <div id="content-primary" class="span8">
      <div id='tryocaml' class="content" style='display:none;'>
        <div class="container">
          <div class="row">
            <div id="lesson-message"></div>
            <div id="languages" style='display:none;'></div>
            <div id="menu-lessons" style='display:none'>
              <table class="zebra-striped">
                <tr><td id="text-x"><code></code></td> <td id=""></td></tr>
              </table>
            </div>
            <div class="span9 ocaml">
              <div id="toplevel-container">
                <pre id="output"></pre>
                <div id="sharp">#</div>
                <div id="toplevel"></div>
              </div>
              <div id="buttons"></div>
              <div id="graphics-title"></div>
              <div id="graphics"></div>
            </div>
          </div>
        </div>
      </div>

      <div id='main-contents' class="content">
        <h1 id="Typesdedonnesetfiltragedemotif"> Types de donn√©es et filtrage de motif</h1><h2 id="Listeschanes"> Listes cha√Æn√©es</h2><p>

Comme en Perl, la notion de liste est directement support√©e dans le
langage OCaml. En OCaml, tous les √©l√©ments d&#39;une liste doivent avoir le
m√™me type. Une liste s&#39;√©crit :</p>
<pre><code class='tryocaml'><span class='keywordsign'>[</span><span class='number'>1</span><span class='keywordsign'>;</span> <span class='number'>2</span><span class='keywordsign'>;</span> <span class='number'>3</span><span class='keywordsign'>]</span>
</code></pre>
<p>
(Remarquez l&#39;utilisation de points-virgules, et non de virgules).</p>
<p><code>[]</code> est la liste vide.</p>
<p>Une liste a une <strong>t√™te</strong> (le premier √©l√©ment) et une <strong>queue</strong> (les
autres √©l√©ments). La t√™te est un √©l√©ment, la queue est une liste, donc
dans cet exemple la t√™te est l&#39;entier <code>1</code> alors que la queue est la
<em>liste</em> <code>[2; 3]</code>.</p>
<p>Une autre fa√ßon d&#39;√©crire une liste est d&#39;utiliser l&#39;op√©rateur <strong>cons</strong>
<code>t√™te :: queue</code>. Toutes les expressions suivantes sont donc √©quivalentes
:</p>
<pre><code class='tryocaml'><span class='keywordsign'>[</span><span class='number'>1</span><span class='keywordsign'>;</span> <span class='number'>2</span><span class='keywordsign'>;</span> <span class='number'>3</span><span class='keywordsign'>]</span>
<span class='number'>1</span> <span class='keywordsign'>::</span> <span class='keywordsign'>[</span><span class='number'>2</span><span class='keywordsign'>;</span> <span class='number'>3</span><span class='keywordsign'>]</span>
<span class='number'>1</span> <span class='keywordsign'>::</span> <span class='number'>2</span> <span class='keywordsign'>::</span> <span class='keywordsign'>[</span><span class='number'>3</span><span class='keywordsign'>]</span>
<span class='number'>1</span> <span class='keywordsign'>::</span> <span class='number'>2</span> <span class='keywordsign'>::</span> <span class='number'>3</span> <span class='keywordsign'>::</span> <span class='keywordsign operator'>[]</span>
</code></pre>
<p>
Pourquoi mentionner l&#39;op√©rateur cons ? Et bien nous en aurons besoin un
peu plus bas, pour faire du <em>filtrage</em> (<em>pattern matching</em>) sur les
listes.</p>
<h3 id="Letyped39unelistechane"> Le type d&#39;une liste cha√Æn√©e</h3><p>
Le type d&#39;une liste cha√Æn√©e d&#39;entiers est <code>int list</code>, et plus
g√©n√©ralement le type d&#39;une liste cha√Æn√©e de <code>toto</code>s est <code>toto list</code>.</p>
<p>Cela implique que tous les √©l√©ments d&#39;une liste cha√Æn√©e doivent avoir le
m√™me type; Il existe des types polymorphiques de listes (c√†d <code>&#39;a list</code>),
tr√®s utile pour √©crire des fonctions manipulant des &quot;listes de n&#39;importe
quoi&quot; de mani√®re g√©n√©rique. (Mais <code>&#39;a list</code> ne signifie pas que les
diff√©rents √©l√©ments d&#39;une liste peuvent avoir des types diff√©rents -
vous ne pouvez pas utiliser ce type polymorphique pour construire,
disons, une liste d&#39;entiers et de cha√Ænes. Le sens de cette notation est
que les √©l√©ments de la liste peuvent √™tre n&#39;importe quoi, mais tous &quot;du
m√™me type de n&#39;importe quoi&quot;).</p>
<p>La fonction <code>length</code> d√©finie dans le module standard de OCaml <code>List</code> en
est un bon exemple. Peu importe si une liste contient des entiers, des
cha√Ænes, des objets ou des ratons-laveurs, la fonction <code>List.length</code>
peut √™tre utilis√©e dessus. Le type de <code>List.length</code> est donc :</p>
<pre><code class='tryocaml'><span class='constructor module'>List</span><span class='keywordsign'>.</span><span class='lower'>length</span> <span class='keywordsign'>:</span> <span class='keywordsign'>&#39;</span><span class='lower'>alist</span> <span class='keywordsign'>-&#62;</span> <span class='lower'>int</span>
</code></pre>
<h2 id="Structures"> Structures</h2><p>

Le C et le C++ proposent le concept simple de <code>struct</code>, abbr√©viation de
structure. En Java on peut utiliser des classes √† la place, mais c&#39;est
beaucoup plus laborieux.</p>
<p>Consid√©rons cette simple structure C :</p>
<pre><code class='tryocaml'><span class='keyword'>struct</span> <span class='lower'>paire_dentiers</span> <span class='keywordsign'>{</span>
  <span class='lower'>int</span> <span class='lower'>a</span><span class='keywordsign'>,</span> <span class='lower'>b</span><span class='keywordsign'>;</span>
<span class='keywordsign'>}</span><span class='keywordsign'>;</span>
</code></pre>
<p>
L&#39;√©quivalent le plus simple en OCaml sont les <strong>n-uplets</strong> (tuples),
comme la paire <code>(3, 4)</code> qui a pour type <code>int * int</code>. Contrairement aux
listes, les n-uplets peuvent contenir des √©l√©ments de types diff√©rents,
par exemple <code>(3, &quot;hello&quot;, &#39;x&#39;)</code> qui a pour type <code>int * string * char</code>.</p>
<p>Une mani√®re l√©g√®rement plus complexe de traduire les struct C est
d&#39;utiliser un <strong>enregistrement</strong> (record). Les enregistrements, comme
les structs C, permettent de nommer leurs composants. Les composants des
n-uplets ne peuvent pas √™tre nomm√©es, et il faut se souvenir de l&#39;ordre
dans lequel ils apparaissent. Voici l&#39;enregistrement √©quivalent au
struct C ci-dessus :</p>
<pre><code class='tryocaml'><span class='keyword'>type</span> <span class='lower'>paire_dentiers</span> <span class='keywordsign'>=</span> <span class='keywordsign'>{</span> <span class='lower'>a</span> <span class='keywordsign'>:</span> <span class='lower'>int</span><span class='keywordsign'>;</span> <span class='lower'>b</span> <span class='keywordsign'>:</span> <span class='lower'>int</span> <span class='keywordsign'>}</span><span class='keywordsign'>;;</span>
</code></pre>
<p>
Ceci d√©finit le type, et voici comment <em>cr√©er</em> effectivement des valeurs
de ce type :</p>
<pre><code class='tryocaml'><span class='keywordsign'>{</span> <span class='lower'>a</span><span class='keywordsign'>=</span><span class='number'>3</span><span class='keywordsign'>;</span> <span class='lower'>b</span><span class='keywordsign'>=</span><span class='number'>5</span> <span class='keywordsign'>}</span>
</code></pre>
<p>
Remarquez l&#39;utilisation de &quot;:&quot; dans la d√©finition du type et de &quot;=&quot; pour
cr√©er des valeurs de ce type.</p>
<p>Voici un exemple d&#39;utilisation des enregistrements, test√© avec la boucle
interactive :</p>
<pre><code class='tryocaml'><span class='keywordsign'>#</span> <span class='keyword'>type</span> <span class='lower'>paire_dentiers</span> <span class='keywordsign'>=</span> <span class='keywordsign'>{</span> <span class='lower'>a</span> <span class='keywordsign'>:</span> <span class='lower'>int</span><span class='keywordsign'>;</span> <span class='lower'>b</span> <span class='keywordsign'>:</span> <span class='lower'>int</span> <span class='keywordsign'>}</span><span class='keywordsign'>;;</span>
<span class='keyword'>type</span> <span class='lower'>paire_dentiers</span> <span class='keywordsign'>=</span> <span class='keywordsign'>{</span> <span class='lower'>a</span> <span class='keywordsign'>:</span> <span class='lower'>int</span><span class='keywordsign'>;</span> <span class='lower'>b</span> <span class='keywordsign'>:</span> <span class='lower'>int</span><span class='keywordsign'>;</span> <span class='keywordsign'>}</span>
<span class='keywordsign'>#</span> <span class='keywordsign'>{</span><span class='lower'>a</span><span class='keywordsign'>=</span><span class='number'>3</span><span class='keywordsign'>;</span> <span class='lower'>b</span><span class='keywordsign'>=</span><span class='number'>5</span><span class='keywordsign'>}</span><span class='keywordsign'>;;</span>
<span class='keywordsign'>-</span> <span class='keywordsign'>:</span> <span class='lower'>paire_dentiers</span> <span class='keywordsign'>=</span> <span class='keywordsign'>{</span><span class='lower'>a</span> <span class='keywordsign'>=</span> <span class='number'>3</span><span class='keywordsign'>;</span> <span class='lower'>b</span> <span class='keywordsign'>=</span> <span class='number'>5</span><span class='keywordsign'>}</span>
<span class='keywordsign'>#</span> <span class='keywordsign'>{</span><span class='lower'>a</span><span class='keywordsign'>=</span><span class='number'>3</span><span class='keywordsign'>}</span><span class='keywordsign'>;;</span>
<span class='constructor module'>Some</span> <span class='lower'>record</span> <span class='lower'>field</span> <span class='lower'>labels</span> <span class='lower'>are</span> <span class='lower'>undefined</span><span class='keywordsign'>:</span> <span class='lower'>b</span>
</code></pre>
<p>
Donc OCaml refuse de laisser certains champs d&#39;un enregistrement non
d√©finis.</p>
<h2 id="Variantsunionsmarquesetnumrations"> Variants (unions marqu√©es et √©num√©rations)</h2><p>
Le concept d&#39;&quot;union marqu√©e&quot; n&#39;existe pas vraiment en C, bien qu&#39;il
existe dans le compileur gcc. Voici comment on traduit d&#39;habitude une
union marqu√©e en C:</p>
<pre><code class='tryocaml'><span class='keyword'>struct</span> <span class='lower'>foo</span> <span class='keywordsign'>{</span>
  <span class='lower'>int</span> <span class='keyword'>type</span><span class='keywordsign'>;</span>
<span class='keywordsign'>#</span><span class='lower'>define</span> <span class='constructor module'>TYPE_INT</span> <span class='number'>1</span>
<span class='keywordsign'>#</span><span class='lower'>define</span> <span class='constructor module'>TYPE_PAIR_OF_INTS</span> <span class='number'>2</span>
<span class='keywordsign'>#</span><span class='lower'>define</span> <span class='constructor module'>TYPE_STRING</span> <span class='number'>3</span>
  <span class='lower'>union</span> <span class='keywordsign'>{</span>
    <span class='lower'>int</span> <span class='lower'>i</span><span class='keywordsign'>;</span>        <span class='keywordsign infix'>//</span> <span class='constructor module'>Si</span> <span class='keyword'>type</span> <span class='keywordsign infix'>==</span> <span class='constructor module'>TYPE_INT</span><span class='keywordsign'>.</span>
    <span class='lower'>int</span> <span class='lower'>pair</span><span class='keywordsign'>[</span><span class='number'>2</span><span class='keywordsign'>]</span><span class='keywordsign'>;</span>  <span class='keywordsign infix'>//</span> <span class='constructor module'>Si</span> <span class='keyword'>type</span> <span class='keywordsign infix'>==</span> <span class='constructor module'>TYPE_PAIR_OF_INTS</span><span class='keywordsign'>.</span>
    <span class='lower'>char</span> <span class='keywordsign'>*</span><span class='lower'>str</span><span class='keywordsign'>;</span>    <span class='keywordsign infix'>//</span> <span class='constructor module'>Si</span> <span class='keyword'>type</span> <span class='keywordsign infix'>==</span> <span class='constructor module'>TYPE_STRING</span><span class='keywordsign'>.</span>
  <span class='keywordsign'>}</span> <span class='lower'>u</span><span class='keywordsign'>;</span>
<span class='keywordsign'>}</span><span class='keywordsign'>;</span>
</code></pre>
<p>
Je suppose que nous avons tous d√©j√† vu √ßa, et ce n&#39;est pas beau √† voir.
Pour commencer, ce n&#39;est pas s√ªr : le programmeur peut accidentellement
utiliser, disons, le champ <code>u.i</code> quand c&#39;est en fait une cha√Æne qui est
stock√©e dans la structure. Ensuite, le compilateur ne peut pas
facilement v√©rifier que tous les types ont √©t√© consid√©r√©s dans les
instructions <code>switch</code> (on peut utiliser un type <code>enum</code> pour se pr√©munir
contre ce probl√®me pr√©cis). Le programmeur peut aussi oublier de
modifier le champ <code>type</code>, ce qui peut procurer des heures de jeu. Pour
finir, c&#39;est lourdingue.</p>
<p>Voici l&#39;√©quivalent en OCaml, √©l√©gant et concis:</p>
<pre><code class='tryocaml'><span class='keyword'>type</span> <span class='lower'>foo</span> <span class='keywordsign'>=</span> <span class='constructor module'>Nothing</span> <span class='keywordsign'>|</span> <span class='constructor module'>Int</span> <span class='keyword'>of</span> <span class='lower'>int</span> <span class='keywordsign'>|</span> <span class='constructor module'>Pair</span> <span class='keyword'>of</span> <span class='lower'>int</span> <span class='keywordsign'>*</span> <span class='lower'>int</span> <span class='keywordsign'>|</span> <span class='constructor module'>String</span> <span class='keyword'>of</span> <span class='lower'>string</span><span class='keywordsign'>;;</span>
</code></pre>
<p>
Voil√† pour la d√©finition du type. Au d√©but de chacune des sections,
s√©par√©es par des <code>|</code>, se trouve un constructeur. On peut les nommer
comme on veut, tant que leur nom commence par une capitale. Si un
constructeur peut √™tre utilis√© pour d√©finir une valeur, il est suivi de
<code>of</code> et d&#39;un type, qui lui commence par une minuscule. Dans l&#39;exemple
ci-dessus, Nothing est utilis√© comme une constante, alors que les autres
constructeurs d√©finissent des valeurs.</p>
<p>Pour <em>cr√©er</em> effectivement des valeurs de ce type, on peut √©crire:</p>
<pre><code class='tryocaml'><span class='constructor module'>Nothing</span>
<span class='constructor module'>Int</span> <span class='number'>3</span>
<span class='constructor module'>Pair</span> <span class='keywordsign'>(</span><span class='number'>4</span><span class='keywordsign'>,</span> <span class='number'>5</span><span class='keywordsign'>)</span>
<span class='constructor module'>String</span> <span class='string'>&#34;hello&#34;</span>
     <span class='lower'>etc</span><span class='keywordsign'>.</span>
</code></pre>
<p>
Toutes ces expressions ont pour type <code>foo</code>.</p>
<p>Remarquez l&#39;utilisation de <code>of</code> dans la d√©finition du type, qui ne se
retrouve PAS dans l&#39;√©criture des valeurs de ce type.</p>
<p>Par extension, un simple <code>enum</code> C d√©finit comme</p>
<pre><code class='tryocaml'><span class='lower'>enum</span> <span class='lower'>sign</span> <span class='keywordsign'>{</span> <span class='lower'>positive</span><span class='keywordsign'>,</span> <span class='lower'>zero</span><span class='keywordsign'>,</span> <span class='lower'>negative</span> <span class='keywordsign'>}</span><span class='keywordsign'>;</span>
</code></pre>
<p>
peut √™tre traduit en OCaml par</p>
<pre><code class='tryocaml'><span class='keyword'>type</span> <span class='lower'>sign</span> <span class='keywordsign'>=</span> <span class='constructor module'>Positive</span> <span class='keywordsign'>|</span> <span class='constructor module'>Zero</span> <span class='keywordsign'>|</span> <span class='constructor module'>Negative</span><span class='keywordsign'>;;</span>
</code></pre>
<h3 id="Variantsrcursifsutilisspourlesarbres"> Variants r√©cursifs (utilis√©s pour les arbres)</h3><p>

Les variants peuvent √™tre r√©cursifs, ce qui est souvent utilis√© pour
d√©finir des structures de donn√©es arborescentes. C&#39;est vraiment l√† que
se r√©v√®le l&#39;expressivit√© des langages fonctionnels :</p>
<pre><code class='tryocaml'><span class='keyword'>type</span> <span class='lower'>binary_tree</span> <span class='keywordsign'>=</span> <span class='constructor module'>Leaf</span> <span class='keyword'>of</span> <span class='lower'>int</span> <span class='keywordsign'>|</span> <span class='constructor module'>Tree</span> <span class='keyword'>of</span> <span class='lower'>binary_tree</span> <span class='keywordsign'>*</span> <span class='lower'>binary_tree</span><span class='keywordsign'>;;</span>
</code></pre>
<p>
Voil√† quelques arbres binaires. Comme exercice, essayez de les dessiner
sur un bout de papier.</p>
<pre><code class='tryocaml'><span class='constructor module'>Leaf</span> <span class='number'>3</span>

<span class='constructor module'>Tree</span> <span class='keywordsign'>(</span><span class='constructor module'>Leaf</span> <span class='number'>3</span><span class='keywordsign'>,</span> <span class='constructor module'>Leaf</span> <span class='number'>4</span><span class='keywordsign'>)</span>


<span class='constructor module'>Tree</span> <span class='keywordsign'>(</span><span class='constructor module'>Tree</span> <span class='keywordsign'>(</span><span class='constructor module'>Leaf</span> <span class='number'>3</span><span class='keywordsign'>,</span> <span class='constructor module'>Leaf</span> <span class='number'>4</span><span class='keywordsign'>)</span><span class='keywordsign'>,</span> <span class='constructor module'>Leaf</span> <span class='number'>5</span><span class='keywordsign'>)</span>

<span class='constructor module'>Tree</span> <span class='keywordsign'>(</span><span class='constructor module'>Tree</span> <span class='keywordsign'>(</span><span class='constructor module'>Leaf</span> <span class='number'>3</span><span class='keywordsign'>,</span> <span class='constructor module'>Leaf</span> <span class='number'>4</span><span class='keywordsign'>)</span><span class='keywordsign'>,</span> <span class='constructor module'>Tree</span> <span class='keywordsign'>(</span><span class='constructor module'>Tree</span> <span class='keywordsign'>(</span><span class='constructor module'>Leaf</span> <span class='number'>3</span><span class='keywordsign'>,</span> <span class='constructor module'>Leaf</span> <span class='number'>4</span><span class='keywordsign'>)</span><span class='keywordsign'>,</span> <span class='constructor module'>Leaf</span> <span class='number'>5</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span>
</code></pre>
<h3 id="Variantsparamtrs"> Variants param√©tr√©s</h3><p>

L&#39;arbre binaire de la section pr√©c√©dente comporte un entier √† chaque
feuille, mais comment faire pour d√©crire la <em>forme</em> de la structure de
donn√©es, en laissant le choix de ce qui doit √™tre stock√© dans chaque
feuille pour plus tard ? On peut utiliser un variant param√©tr√© (ou
polymorphique), comme ceci :</p>
<pre><code class='tryocaml'><span class='keyword'>type</span> <span class='keywordsign'>&#39;</span><span class='lower'>abinary_tree</span> <span class='keywordsign'>=</span> <span class='constructor module'>Leaf</span> <span class='keyword'>of</span> <span class='keywordsign'>&#39;</span><span class='lower'>a</span><span class='keywordsign'>|</span> <span class='constructor module'>Tree</span> <span class='keyword'>of</span> <span class='keywordsign'>&#39;</span><span class='lower'>abinary_tree</span> <span class='keywordsign'>*</span> <span class='keywordsign'>&#39;</span><span class='lower'>abinary_tree</span><span class='keywordsign'>;;</span>
</code></pre>
<p>
C&#39;est le type g√©n√©ral. Le type o√π chaque feuille stocke un entier
s&#39;appelle <code>int binary_tree</code>. De la m√™me fa√ßon, le type o√π chaque feuille
stocke une cha√Æne s&#39;appelle <code>string binary_tree</code>. Pour l&#39;exemple suivant
nous allons taper des valeurs dans la boucle interactive, et laisser le
syst√®me d&#39;inf√©rence de types nous donner leurs types :</p>
<pre><code class='tryocaml'><span class='keywordsign'>#</span> <span class='constructor module'>Leaf</span> <span class='string'>&#34;hello&#34;</span><span class='keywordsign'>;;</span>
<span class='keywordsign'>-</span> <span class='keywordsign'>:</span> <span class='lower'>string</span> <span class='lower'>binary_tree</span> <span class='keywordsign'>=</span> <span class='constructor module'>Leaf</span> <span class='string'>&#34;hello&#34;</span>
<span class='keywordsign'>#</span> <span class='constructor module'>Leaf</span> <span class='number'>3.0</span><span class='keywordsign'>;;</span>
<span class='keywordsign'>-</span> <span class='keywordsign'>:</span> <span class='lower'>float</span> <span class='lower'>binary_tree</span> <span class='keywordsign'>=</span> <span class='constructor module'>Leaf</span> <span class='number'>3.</span>
</code></pre>
<p>
Remarquez que le nom des types est √† l&#39;envers (arbre binaire de
flottants -\&gt; float binary_tree). C&#39;est comparable avec le nom des
types pour les listes, ie <code>int list</code>, etc.</p>
<p>En fait ce n&#39;est pas une co√Øncidence si <code>&#39;a list</code> est √©crit lui aussi &quot;√†
l&#39;envers&quot;. Les types listes ne sont que des types variants param√©tr√©s,
avec une d√©finition l√©g√®rement sp√©ciale :</p>
<pre><code class='tryocaml'> <span class='keyword'>type</span> <span class='keywordsign'>&#39;</span><span class='lower'>alist</span> <span class='keywordsign'>=</span> <span class='keywordsign operator'>[]</span> <span class='keywordsign'>|</span> <span class='keywordsign'>::</span> <span class='keyword'>of</span> <span class='keywordsign'>&#39;</span><span class='lower'>a</span><span class='keywordsign'>*</span> <span class='keywordsign'>&#39;</span><span class='lower'>alist</span>   <span class='comment'>(* ceci n&#39;est pas du vrai code OCaml *)</span>
</code></pre>
<p>
En fait la d√©finition ci-dessus ne compile pas. La d√©finition suivante,
tr√®s similaire, compile correctement :</p>
<pre><code class='tryocaml'><span class='keywordsign'>#</span> <span class='keyword'>type</span> <span class='keywordsign'>&#39;</span><span class='lower'>alist</span> <span class='keywordsign'>=</span> <span class='constructor module'>Nil</span> <span class='keywordsign'>|</span> <span class='keywordsign'>::</span> <span class='keyword'>of</span> <span class='keywordsign'>&#39;</span><span class='lower'>a</span><span class='keywordsign'>*</span> <span class='keywordsign'>&#39;</span><span class='lower'>alist</span><span class='keywordsign'>;;</span>
<span class='keyword'>type</span> <span class='keywordsign'>&#39;</span><span class='lower'>alist</span> <span class='keywordsign'>=</span> <span class='constructor module'>Nil</span> <span class='keywordsign'>|</span> <span class='keywordsign'>::</span> <span class='keyword'>of</span> <span class='keywordsign'>&#39;</span><span class='lower'>a</span><span class='keywordsign'>*</span> <span class='keywordsign'>&#39;</span><span class='lower'>alist</span>
<span class='keywordsign'>#</span> <span class='constructor module'>Nil</span><span class='keywordsign'>;;</span>
<span class='keywordsign'>-</span> <span class='keywordsign'>:</span> <span class='keywordsign'>&#39;</span><span class='lower'>alist</span> <span class='keywordsign'>=</span> <span class='constructor module'>Nil</span>
<span class='keywordsign'>#</span> <span class='number'>1</span> <span class='keywordsign'>::</span> <span class='constructor module'>Nil</span><span class='keywordsign'>;;</span>
<span class='keywordsign'>-</span> <span class='keywordsign'>:</span> <span class='lower'>int</span> <span class='lower'>list</span> <span class='keywordsign'>=</span> <span class='keywordsign'>::</span> <span class='keywordsign'>(</span><span class='number'>1</span><span class='keywordsign'>,</span> <span class='constructor module'>Nil</span><span class='keywordsign'>)</span>
<span class='keywordsign'>#</span> <span class='number'>1</span> <span class='keywordsign'>::</span> <span class='number'>2</span> <span class='keywordsign'>::</span> <span class='constructor module'>Nil</span><span class='keywordsign'>;;</span>
<span class='keywordsign'>-</span> <span class='keywordsign'>:</span> <span class='lower'>int</span> <span class='lower'>list</span> <span class='keywordsign'>=</span> <span class='keywordsign'>::</span> <span class='keywordsign'>(</span><span class='number'>1</span><span class='keywordsign'>,</span> <span class='keywordsign'>::</span> <span class='keywordsign'>(</span><span class='number'>2</span><span class='keywordsign'>,</span> <span class='constructor module'>Nil</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span>
</code></pre>
<p>
Rappelez vous quand nous avons dit pr√©c√©demment que les listes pouvaient
√™tre √©crites de deux fa√ßons, soit sous la forme syntaxiquement √©dulcor√©e
<code>[1; 2; 3]</code> ou sous la forme plus formelle <code>1 :: 2 :: 3 :: []</code>. En
regardant la d√©finition de <code>&#39;a list</code> ci-dessus, l&#39;origine de la syntaxe
formelle devrait vous para√Ætre plus clairement.</p>
<h2 id="ListesstructuresetvariantsRsum"> Listes, structures et variants ‚Äî R√©sum√©</h2><p>
tableau en 3 colonnes avec nom et exemples de d√©finition et de valeur.</p>
<pre><code class='tryocaml'>Characters 1:30 - 1:31 :
Error: Lexical error: don't know what to do with character '√'
</code></pre>
<h2 id="Filtragesurlesstructuresdedonnes"> Filtrage (sur les structures de donn√©es)</h2><p>

Une &quot;Fonctionnalit√© Vraiment Cool&quot;(tm) des langages fonctionnels est
leur capacit√© √† d√©monter les structures de donn√©es et √† effectuer du
filtrage (pattern matching) sur les donn√©es. Ce n&#39;est pas √† proprement
parler une propri√©t√© &quot;fonctionnelle&quot; - on pourrait tr√®s bien imaginer
une nouvelle sorte de C qui offrirait ces m√™mes services. Mais c&#39;est
tout de m√™me une &quot;Fonctionnalit√© Vraiment Cool&quot;.</p>
<p>Commen√ßons par un probl√®me r√©el : je veux repr√©senter des expressions
math√©matiques simples comme <code>n * (x + y)</code> et effectuer les
multiplications symboliquement pour obtenir <code>n * x + n * y</code>.</p>
<p>D√©finissons un type pour ces expressions:</p>
<pre><code class='tryocaml'><span class='keyword'>type</span> <span class='lower'>expr</span> <span class='keywordsign'>=</span> <span class='constructor module'>Plus</span> <span class='keyword'>of</span> <span class='lower'>expr</span> <span class='keywordsign'>*</span> <span class='lower'>expr</span>        <span class='comment'>(* pour a + b *)</span>
          <span class='keywordsign'>|</span> <span class='constructor module'>Minus</span> <span class='keyword'>of</span> <span class='lower'>expr</span> <span class='keywordsign'>*</span> <span class='lower'>expr</span>       <span class='comment'>(* pour a - b *)</span>
          <span class='keywordsign'>|</span> <span class='constructor module'>Times</span> <span class='keyword'>of</span> <span class='lower'>expr</span> <span class='keywordsign'>*</span> <span class='lower'>expr</span>       <span class='comment'>(* pour a * b *)</span>
      <span class='keywordsign'>|</span> <span class='constructor module'>Divide</span> <span class='keyword'>of</span> <span class='lower'>expr</span> <span class='keywordsign'>*</span> <span class='lower'>expr</span>      <span class='comment'>(* pour a / b *)</span>
          <span class='keywordsign'>|</span> <span class='constructor module'>Value</span> <span class='keyword'>of</span> <span class='lower'>string</span>            <span class='comment'>(* &#34;x&#34;, &#34;y&#34;, &#34;n&#34;, etc. *)</span>
      <span class='keywordsign'>;;</span>
</code></pre>
<p>
L&#39;expression <code>n * (x + y)</code> s&#39;√©crirait:</p>
<pre><code class='tryocaml'><span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='constructor module'>Value</span> <span class='string'>&#34;n&#34;</span><span class='keywordsign'>,</span> <span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='constructor module'>Value</span> <span class='string'>&#34;x&#34;</span><span class='keywordsign'>,</span> <span class='constructor module'>Value</span> <span class='string'>&#34;y&#34;</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span>
</code></pre>
<p>
Ecrivons une fonction qui affiche
<code>Times (Value &quot;n&quot;, Plus (Value &quot;x&quot;, Value &quot;y&quot;))</code> comme <code>n * (x + y)</code>. En
fait, je vais √©crire deux fonctions, l&#39;une qui convertit une expression
en une jolie cha√Æne, et une autre qui l&#39;affiche (comme √ßa si j&#39;ai envie
d&#39;√©crire la m√™me cha√Æne dans un fichier, je n&#39;aurais pas √† r√©√©crire la
fonction en entier juste pour √ßa).</p>
<pre><code class='tryocaml'><span class='keyword'>let</span> <span class='keyword'>rec</span> <span class='lower'>to_string</span> <span class='lower'>e</span> <span class='keywordsign'>=</span>
  <span class='keyword'>match</span> <span class='lower'>e</span> <span class='keyword'>with</span>
    <span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='lower'>left</span><span class='keywordsign'>,</span> <span class='lower'>right</span><span class='keywordsign'>)</span>   <span class='keywordsign'>-&#62;</span> <span class='string'>&#34;(&#34;</span> <span class='keywordsign infix'>^</span> <span class='keywordsign'>(</span><span class='lower'>to_string</span> <span class='lower'>left</span><span class='keywordsign'>)</span> <span class='keywordsign infix'>^</span> <span class='string'>&#34; + &#34;</span> <span class='keywordsign infix'>^</span> <span class='keywordsign'>(</span><span class='lower'>to_string</span> <span class='lower'>right</span><span class='keywordsign'>)</span> <span class='keywordsign infix'>^</span> <span class='string'>&#34;)&#34;</span>
  <span class='keywordsign'>|</span> <span class='constructor module'>Minus</span> <span class='keywordsign'>(</span><span class='lower'>left</span><span class='keywordsign'>,</span> <span class='lower'>right</span><span class='keywordsign'>)</span>  <span class='keywordsign'>-&#62;</span> <span class='string'>&#34;(&#34;</span> <span class='keywordsign infix'>^</span> <span class='keywordsign'>(</span><span class='lower'>to_string</span> <span class='lower'>left</span><span class='keywordsign'>)</span> <span class='keywordsign infix'>^</span> <span class='string'>&#34; - &#34;</span> <span class='keywordsign infix'>^</span> <span class='keywordsign'>(</span><span class='lower'>to_string</span> <span class='lower'>right</span><span class='keywordsign'>)</span> <span class='keywordsign infix'>^</span> <span class='string'>&#34;)&#34;</span>

  <span class='keywordsign'>|</span> <span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='lower'>left</span><span class='keywordsign'>,</span> <span class='lower'>right</span><span class='keywordsign'>)</span>  <span class='keywordsign'>-&#62;</span> <span class='string'>&#34;(&#34;</span> <span class='keywordsign infix'>^</span> <span class='keywordsign'>(</span><span class='lower'>to_string</span> <span class='lower'>left</span><span class='keywordsign'>)</span> <span class='keywordsign infix'>^</span> <span class='string'>&#34; * &#34;</span> <span class='keywordsign infix'>^</span> <span class='keywordsign'>(</span><span class='lower'>to_string</span> <span class='lower'>right</span><span class='keywordsign'>)</span> <span class='keywordsign infix'>^</span> <span class='string'>&#34;)&#34;</span>
  <span class='keywordsign'>|</span> <span class='constructor module'>Divide</span> <span class='keywordsign'>(</span><span class='lower'>left</span><span class='keywordsign'>,</span> <span class='lower'>right</span><span class='keywordsign'>)</span> <span class='keywordsign'>-&#62;</span> <span class='string'>&#34;(&#34;</span> <span class='keywordsign infix'>^</span> <span class='keywordsign'>(</span><span class='lower'>to_string</span> <span class='lower'>left</span><span class='keywordsign'>)</span> <span class='keywordsign infix'>^</span> <span class='string'>&#34; / &#34;</span> <span class='keywordsign infix'>^</span> <span class='keywordsign'>(</span><span class='lower'>to_string</span> <span class='lower'>right</span><span class='keywordsign'>)</span> <span class='keywordsign infix'>^</span> <span class='string'>&#34;)&#34;</span>

  <span class='keywordsign'>|</span> <span class='constructor module'>Value</span> <span class='lower'>v</span> <span class='keywordsign'>-&#62;</span> <span class='lower'>v</span>
  <span class='keywordsign'>;;</span>

<span class='keyword'>let</span> <span class='lower'>print_expr</span> <span class='lower'>e</span> <span class='keywordsign'>=</span>
  <span class='lower'>print_endline</span> <span class='keywordsign'>(</span><span class='lower'>to_string</span> <span class='lower'>e</span><span class='keywordsign'>)</span><span class='keywordsign'>;;</span>
</code></pre>
<p>
(NB: L&#39;op√©rateur <code>^</code> sert √† concat√©ner les cha√Ænes.)</p>
<p>Voil√† la fonction d&#39;affichage √† l&#39;oeuvre:</p>
<pre><code class='tryocaml'><span class='keywordsign'>#</span> <span class='lower'>print_expr</span> <span class='keywordsign'>(</span><span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='constructor module'>Value</span> <span class='string'>&#34;n&#34;</span><span class='keywordsign'>,</span> <span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='constructor module'>Value</span> <span class='string'>&#34;x&#34;</span><span class='keywordsign'>,</span> <span class='constructor module'>Value</span> <span class='string'>&#34;y&#34;</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span><span class='keywordsign'>;;</span>
<span class='keywordsign'>(</span><span class='lower'>n</span> <span class='keywordsign'>*</span> <span class='keywordsign'>(</span><span class='lower'>x</span> <span class='keywordsign'>+</span> <span class='lower'>y</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span>
</code></pre>
<p>
La forme g√©n√©rale pour le filtrage est:</p>
<pre><code class='tryocaml'>Characters 2:16 - 2:17 :
Error: Lexical error: don't know what to do with character '√'
</code></pre>
<p>
Les motifs dans la colonne de gauche peuvent √™tre simples, comme dans la
fonction <code>to_string</code> ci-dessus, ou plus complexe et imbriqu√©s. L&#39;exemple
suivant est notre fonction de distribution symbolique de la
multiplication des expressions de la forme <code>n * (x + y)</code> ou
<code>(x + y) * n</code>, et pour cela on va utiliser un motif imbriqu√© :</p>
<pre><code class='tryocaml'><span class='keyword'>let</span> <span class='keyword'>rec</span> <span class='lower'>multiply_out</span> <span class='lower'>e</span> <span class='keywordsign'>=</span>
  <span class='keyword'>match</span> <span class='lower'>e</span> <span class='keyword'>with</span>
    <span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='lower'>e1</span><span class='keywordsign'>,</span> <span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='lower'>e2</span><span class='keywordsign'>,</span> <span class='lower'>e3</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span> <span class='keywordsign'>-&#62;</span>
      <span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='lower'>multiply_out</span> <span class='lower'>e1</span><span class='keywordsign'>,</span> <span class='lower'>multiply_out</span> <span class='lower'>e2</span><span class='keywordsign'>)</span><span class='keywordsign'>,</span>
            <span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='lower'>multiply_out</span> <span class='lower'>e1</span><span class='keywordsign'>,</span> <span class='lower'>multiply_out</span> <span class='lower'>e3</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span>
  <span class='keywordsign'>|</span> <span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='lower'>e1</span><span class='keywordsign'>,</span> <span class='lower'>e2</span><span class='keywordsign'>)</span><span class='keywordsign'>,</span> <span class='lower'>e3</span><span class='keywordsign'>)</span> <span class='keywordsign'>-&#62;</span>
      <span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='lower'>multiply_out</span> <span class='lower'>e1</span><span class='keywordsign'>,</span> <span class='lower'>multiply_out</span> <span class='lower'>e3</span><span class='keywordsign'>)</span><span class='keywordsign'>,</span>
            <span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='lower'>multiply_out</span> <span class='lower'>e2</span><span class='keywordsign'>,</span> <span class='lower'>multiply_out</span> <span class='lower'>e3</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span>
  <span class='keywordsign'>|</span> <span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='lower'>left</span><span class='keywordsign'>,</span> <span class='lower'>right</span><span class='keywordsign'>)</span> <span class='keywordsign'>-&#62;</span> <span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='lower'>multiply_out</span> <span class='lower'>left</span><span class='keywordsign'>,</span> <span class='lower'>multiply_out</span> <span class='lower'>right</span><span class='keywordsign'>)</span>
  <span class='keywordsign'>|</span> <span class='constructor module'>Minus</span> <span class='keywordsign'>(</span><span class='lower'>left</span><span class='keywordsign'>,</span> <span class='lower'>right</span><span class='keywordsign'>)</span> <span class='keywordsign'>-&#62;</span> <span class='constructor module'>Minus</span> <span class='keywordsign'>(</span><span class='lower'>multiply_out</span> <span class='lower'>left</span><span class='keywordsign'>,</span> <span class='lower'>multiply_out</span> <span class='lower'>right</span><span class='keywordsign'>)</span>
  <span class='keywordsign'>|</span> <span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='lower'>left</span><span class='keywordsign'>,</span> <span class='lower'>right</span><span class='keywordsign'>)</span> <span class='keywordsign'>-&#62;</span> <span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='lower'>multiply_out</span> <span class='lower'>left</span><span class='keywordsign'>,</span> <span class='lower'>multiply_out</span> <span class='lower'>right</span><span class='keywordsign'>)</span>
  <span class='keywordsign'>|</span> <span class='constructor module'>Divide</span> <span class='keywordsign'>(</span><span class='lower'>left</span><span class='keywordsign'>,</span> <span class='lower'>right</span><span class='keywordsign'>)</span> <span class='keywordsign'>-&#62;</span> <span class='constructor module'>Divide</span> <span class='keywordsign'>(</span><span class='lower'>multiply_out</span> <span class='lower'>left</span><span class='keywordsign'>,</span> <span class='lower'>multiply_out</span> <span class='lower'>right</span><span class='keywordsign'>)</span>
  <span class='keywordsign'>|</span> <span class='constructor module'>Value</span> <span class='lower'>v</span> <span class='keywordsign'>-&#62;</span> <span class='constructor module'>Value</span> <span class='lower'>v</span>
  <span class='keywordsign'>;;</span>
</code></pre>
<p>
La voil√† en action:</p>
<pre><code class='tryocaml'><span class='keywordsign'>#</span> <span class='lower'>print_expr</span> <span class='keywordsign'>(</span><span class='lower'>multiply_out</span> <span class='keywordsign'>(</span><span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='constructor module'>Value</span> <span class='string'>&#34;n&#34;</span><span class='keywordsign'>,</span> <span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='constructor module'>Value</span> <span class='string'>&#34;x&#34;</span><span class='keywordsign'>,</span> <span class='constructor module'>Value</span> <span class='string'>&#34;y&#34;</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span><span class='keywordsign'>;;</span>
<span class='keywordsign'>(</span><span class='keywordsign'>(</span><span class='lower'>n</span> <span class='keywordsign'>*</span> <span class='lower'>x</span><span class='keywordsign'>)</span> <span class='keywordsign'>+</span> <span class='keywordsign'>(</span><span class='lower'>n</span> <span class='keywordsign'>*</span> <span class='lower'>y</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span>
</code></pre>
<p>
Comment est-ce que marche la fonction <code>multiply_out</code> ? L&#39;essentiel se
trouve dans les deux premiers motifs. Le premier est
<code>Times (e1, Plus (e2, e3))</code> qui filtre les expressions de la forme
<code>e1 * (e2 + e3)</code>. Regardez la colonne de droite en face de ce motif, et
assurez vous que son contenu √©quivaut √† <code>(e1 * e2) + (e1 * e3)</code>.</p>
<p>Le second motif fait la m√™me chose pour les expressions de la forme
<code>(e1 + e2) * e3</code>.</p>
<p>Les autres motifs ne modifient pas la forme de l&#39;expression, mais font
le travail n√©cessaire d&#39;appeler la fonction <code>multiply_out</code> r√©cursivement
sur leurs sous-expressions. Cela garantit que toutes les
sous-expressions de l&#39;expression sont correctement transform√©es. (Si
vous n&#39;√©tiez concern√©s que par la transformation de l&#39;expression la plus
externe, tous ces motifs auraient pu √™tre remplac√©s par une simple r√®gle
<code>e -&gt; e</code>).</p>
<p>Est-ce que l&#39;on peut effectuer l&#39;op√©ration inverse (c√†d factoriser au
lieu de distribuer) ? Bien s√ªr ! (Mais c&#39;est un peu plus compliqu√©...).
La version suivante ne marche que pour l&#39;expression la plus externe.
Vous pourriez certainement l&#39;am√©liorer pour g√©rer tous les niveaux de
sous-expressions, et des cas plus complexes :</p>
<pre><code class='tryocaml'><span class='keyword'>let</span> <span class='lower'>factorize</span> <span class='lower'>e</span> <span class='keywordsign'>=</span>
  <span class='keyword'>match</span> <span class='lower'>e</span> <span class='keyword'>with</span>
    <span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='lower'>e1</span><span class='keywordsign'>,</span> <span class='lower'>e2</span><span class='keywordsign'>)</span><span class='keywordsign'>,</span> <span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='lower'>e3</span><span class='keywordsign'>,</span> <span class='lower'>e4</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span> <span class='keyword'>when</span> <span class='lower'>e1</span> <span class='keywordsign'>=</span> <span class='lower'>e3</span> <span class='keywordsign'>-&#62;</span> <span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='lower'>e1</span><span class='keywordsign'>,</span> <span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='lower'>e2</span><span class='keywordsign'>,</span> <span class='lower'>e4</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span>
  <span class='keywordsign'>|</span> <span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='lower'>e1</span><span class='keywordsign'>,</span> <span class='lower'>e2</span><span class='keywordsign'>)</span><span class='keywordsign'>,</span> <span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='lower'>e3</span><span class='keywordsign'>,</span> <span class='lower'>e4</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span> <span class='keyword'>when</span> <span class='lower'>e2</span> <span class='keywordsign'>=</span> <span class='lower'>e4</span> <span class='keywordsign'>-&#62;</span> <span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='lower'>e1</span><span class='keywordsign'>,</span> <span class='lower'>e3</span><span class='keywordsign'>)</span><span class='keywordsign'>,</span> <span class='lower'>e4</span><span class='keywordsign'>)</span>
  <span class='keywordsign'>|</span> <span class='lower'>e</span> <span class='keywordsign'>-&#62;</span> <span class='lower'>e</span>
  <span class='keywordsign'>;;</span>

<span class='keywordsign'>#</span> <span class='lower'>factorize</span> <span class='keywordsign'>(</span><span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='constructor module'>Value</span> <span class='string'>&#34;n&#34;</span><span class='keywordsign'>,</span> <span class='constructor module'>Value</span> <span class='string'>&#34;x&#34;</span><span class='keywordsign'>)</span><span class='keywordsign'>,</span> <span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='constructor module'>Value</span> <span class='string'>&#34;n&#34;</span><span class='keywordsign'>,</span> <span class='constructor module'>Value</span> <span class='string'>&#34;y&#34;</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span><span class='keywordsign'>;;</span>
<span class='keywordsign'>-</span> <span class='keywordsign'>:</span> <span class='lower'>expr</span> <span class='keywordsign'>=</span> <span class='constructor module'>Times</span> <span class='keywordsign'>(</span><span class='constructor module'>Value</span> <span class='string'>&#34;n&#34;</span><span class='keywordsign'>,</span> <span class='constructor module'>Plus</span> <span class='keywordsign'>(</span><span class='constructor module'>Value</span> <span class='string'>&#34;x&#34;</span><span class='keywordsign'>,</span> <span class='constructor module'>Value</span> <span class='string'>&#34;y&#34;</span><span class='keywordsign'>)</span><span class='keywordsign'>)</span>
</code></pre>
<p>
La fonction de factorisation ci-dessus introduit une paire de nouvelles
fonctionnalit√©s. Vous pouvez ajouter ce qui s&#39;appelle une <strong>garde</strong> √†
chaque motif. Une garde est une condition pr√©c√©d√©e de <code>when</code>, et qui
signifie que le filtrage n&#39;est fructueux que si le motif correspond <em>et</em>
la condition apr√®s la clause <code>when</code> est satisfaite.</p>
<pre><code class='tryocaml'>Characters 2:39 - 2:40 :
Error: Lexical error: don't know what to do with character '√'
</code></pre>
<p>
La seconde fonctionalit√© est l&#39;op√©rateur <code>=</code> qui teste l&#39;&quot;√©galit√©
structurelle&quot; de deux expressions. Cela signifie qu&#39;il descend
r√©cursivement dans chacune de deux expressions pour v√©rifier qu&#39;elles
sont identiques √† tous les niveaux.</p>
<p>OCaml est capable de v√©rifier au moment de la compilation que tous les
cas sont couverts par vos motifs. J&#39;ai modifi√© la d√©finition du
<code>type expr</code> pr√©c√©dent pour y ajouter le constructeur <code>Product</code> :</p>
<pre><code class='tryocaml'><span class='keyword'>type</span> <span class='lower'>expr</span> <span class='keywordsign'>=</span> <span class='constructor module'>Plus</span> <span class='keyword'>of</span> <span class='lower'>expr</span> <span class='keywordsign'>*</span> <span class='lower'>expr</span>        <span class='comment'>(* pour a + b *)</span>
          <span class='keywordsign'>|</span> <span class='constructor module'>Minus</span> <span class='keyword'>of</span> <span class='lower'>expr</span> <span class='keywordsign'>*</span> <span class='lower'>expr</span>       <span class='comment'>(* pour a - b *)</span>
          <span class='keywordsign'>|</span> <span class='constructor module'>Times</span> <span class='keyword'>of</span> <span class='lower'>expr</span> <span class='keywordsign'>*</span> <span class='lower'>expr</span>       <span class='comment'>(* pour a * b *)</span>
      <span class='keywordsign'>|</span> <span class='constructor module'>Divide</span> <span class='keyword'>of</span> <span class='lower'>expr</span> <span class='keywordsign'>*</span> <span class='lower'>expr</span>      <span class='comment'>(* pour a / b *)</span>
      <span class='keywordsign'>|</span> <span class='constructor module'>Product</span> <span class='keyword'>of</span> <span class='lower'>expr</span> <span class='lower'>list</span>       <span class='comment'>(* pour a * b * c * ... *)</span>
          <span class='keywordsign'>|</span> <span class='constructor module'>Value</span> <span class='keyword'>of</span> <span class='lower'>string</span>            <span class='comment'>(* &#34;x&#34;, &#34;y&#34;, &#34;n&#34;, etc. *)</span>
      <span class='keywordsign'>;;</span>
</code></pre>
<p>
J&#39;ai ensuite recompil√© la fonction <code>to_string</code> sans modifications. OCaml
a renvoy√© l&#39;avertissement suivant :</p>
<pre><code class='tryocaml'><span class='constructor module'>Warning</span><span class='keywordsign'>:</span> <span class='lower'>this</span> <span class='lower'>pattern</span><span class='keywordsign'>-</span><span class='lower'>matching</span> <span class='lower'>is</span> <span class='lower'>not</span> <span class='lower'>exhaustive</span><span class='keywordsign'>.</span>
<span class='constructor module'>Here</span> <span class='lower'>is</span> <span class='lower'>an</span> <span class='lower'>example</span> <span class='keyword'>of</span> <span class='lower'>a</span> <span class='lower'>value</span> <span class='lower'>that</span> <span class='lower'>is</span> <span class='lower'>not</span> <span class='lower'>matched</span><span class='keywordsign'>:</span>
<span class='constructor module'>Product</span> <span class='keywordsign'>_</span>

</code></pre>

      </div>
    </div>
  </div>
</div>

    <footer id="footer" class="navbar navbar-inverse navbar-fixed-bottom">
      <div class="navbar-inner">
        <div class="container-fluid">
          <ul class="nav pull-left">
            <li><a style='cursor:pointer;' onclick="document.getElementById('footer').style.display='none'">[X]</a></li>

            <li><a href="https://github.com/ocamllabs/sandbox-ocaml.org/tree/master/md-pages/learn/tutorials/data_types_and_matching.fr.md">Edit this page</a></li>
          </ul>
          <ul class="nav pull-right">
            <li><a href="https://github.com/ocamllabs/sandbox-ocaml.org/issues">Feedback</a></li>
            <li><a href="https://github.com/ocamllabs/sandbox-ocaml.org/issues">Contact us</a></li>
            <li><a href="https://github.com/ocamllabs/sandbox-ocaml.org/">Find us on GitHub</a></li>
          </ul>
        </div>
      </div>
    </footer>
    <!-- Load javascript from CDN -->
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
    <script type="text/javascript">
      // <!--
      if(document.getElementsByTagName('pre').length > 0)
         octry('')
      // -->
    </script>
  </body>
</html>
