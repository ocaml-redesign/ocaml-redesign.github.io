<!DOCTYPE HTML>

<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title> &ndash; OCaml</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Google Web Fonts -->
    <link href="http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet">
    <link href="http://fonts.googleapis.com/css?family=Domine:400,700" rel="stylesheet">
    <!-- Only part of Bootstrap that we don't load from a CDN is our own customized CSS build. -->
    <link href="/static/css/bootstrap.css" rel="stylesheet" media="screen">
    <!--[if lt IE 9]>
        <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6.2/html5shiv.js"></script>
    <![endif]-->

 <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
 <script type="text/javascript" src="/docs/opam/doc_loader.js"></script>
    <script type="text/javascript">
      function octry(x){
        if(document.getElementById('buttons').innerHTML=='') {
          t = document.getElementById('tryocaml');
          js = document.createElement("script"); js.type = "text/javascript"; js.src = "/try-ocaml.js";
          t.appendChild(js);
        } else {
          t = document.getElementById('tryocaml');
          t.style.display = 'block';
          document.getElementById('console').value = x;
          document.getElementById('console').focus();
          document.getElementById('console').select();
        }
      }
      if(!(document.getElementById('buttons'))) octry = function() {}
    </script>
  </head>
  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="/"><img src="/static/img/ocaml.png" alt="OCaml"></a>
          <div class="nav-collapse collapse">
                        <ul class="nav">
              <li ><a href="/learn/">Learn</a></li>
              <li ><a href="/docs/">Documentation</a></li>
              <li ><a href="/platform/">Platform</a></li>
              <li ><a href="/list.html">Packages</a></li>
              <li ><a href="/community/">Community</a></li>
            </ul>

            <form class="navbar-search pull-right">
              <input class="search-query" type="text" placeholder="Search" />
            </form>
          </div>
        </div>
      </div>
    </nav>
    
        <div class="container">
      <div class="row">



          <div id='main-contents' class="content">
            <div class="ocaml_toplevel_module"><div class="info">Lwt switches</div>
<div class="info"><div class="info">Switch have two goals:<br/>    - being able to free multiple resources at the same time,<ul><li>offer a better alternative than always returning an id to free
      some resource.</li></ul>    For example, considers the following interface:<br/>    <pre class="codepre"><code class="code">
      type id

      val free : id -&gt; unit Lwt.t

      val f : unit -&gt; id Lwt.t
      val g : unit -&gt; id Lwt.t
      val h : unit -&gt; id Lwt.t
    </code></pre><br/>    Now you want to calls <code class="code">f</code>, <code class="code">g</code> and <code class="code">h</code> in parallel. You can
    simply do:<br/>    <pre class="codepre"><code class="code">
      lwt idf = f () and idg = g () and idh = h () in
      ...
    </code></pre><br/>    However, one may wants to handle possible failures of <code class="code">f ()</code>, <code class="code">g
    ()</code> and <code class="code">h ()</code>, and disable all allocated resources if one of
    these three threads fails. This may be hard since you have to
    remember which one failed and which one returned correctly.<br/>    Now we change a little bit the interface:<br/>    <pre class="codepre"><code class="code">
      val f : ?switch : Lwt_switch.t -&gt; unit -&gt; id Lwt.t
      val g : ?switch : Lwt_switch.t -&gt; unit -&gt; id Lwt.t
      val h : ?switch : Lwt_switch.t -&gt; unit -&gt; id Lwt.t
    </code></pre><br/>    and the code becomes:<br/>    <pre class="codepre"><code class="code">
      let switch = Lwt_switch.create () in
      try_lwt
        lwt idf = f ~switch () and idg = g ~switch () and idh = h ~switch () in
        ...
      with exn -&gt;
        lwt () = Lwt_switch.turn_off switch in
        raise_lwt exn
    </code></pre></div></div>
<pre><span class="TYPEt"><span class="keyword">type</span> t</span> </pre><div class="info"><div class="info">Type of switches.</div></div>
<pre><span class="VALcreate"><span class="keyword">val</span> create</span> : <code class="type">unit -&gt; <a href="?package=lwt&amp;module=Lwt_switch&amp;type=t">t</a></code></pre><div class="info"><div class="info"><code class="code">create ()</code> creates a new switch.</div></div>
<pre><span class="VALis_on"><span class="keyword">val</span> is_on</span> : <code class="type"><a href="?package=lwt&amp;module=Lwt_switch&amp;type=t">t</a> -&gt; bool</code></pre><div class="info"><div class="info"><code class="code">is_on switch</code> returns <code class="code">true</code> if the switch is currently on, and
      <code class="code">false</code> otherwise.</div></div>
<pre><span class="VALturn_off"><span class="keyword">val</span> turn_off</span> : <code class="type"><a href="?package=lwt&amp;module=Lwt_switch&amp;type=t">t</a> -&gt; unit <a href="?package=lwt&amp;module=Lwt&amp;type=t">Lwt.t</a></code></pre><div class="info"><div class="info"><code class="code">turn_off switch</code> turns off the switch. It calls all registered
      hooks, waits for all of them to terminates, and the returns. If
      one of the hook failed, then it will fail with one of the
      exception raised by hooks. If the switch is already off, then it
      does nothing.</div></div>
<pre><span class="EXCEPTIONOff"><span class="keyword">exception</span> Off</span></pre><div class="info"><div class="info">Exception raised when trying to add a hook to a switch that is
      already off.</div></div>
<pre><span class="VALcheck"><span class="keyword">val</span> check</span> : <code class="type"><a href="?package=lwt&amp;module=Lwt_switch&amp;type=t">t</a> option -&gt; unit</code></pre><div class="info"><div class="info"><code class="code">check switch</code> does nothing if <code class="code">switch</code> is <code class="code">None</code> or contains an
      switch that is currently on, and raise TODO reference : Off otherwise.</div></div>
<pre><span class="VALadd_hook"><span class="keyword">val</span> add_hook</span> : <code class="type"><a href="?package=lwt&amp;module=Lwt_switch&amp;type=t">t</a> option -&gt; (unit -&gt; unit <a href="?package=lwt&amp;module=Lwt&amp;type=t">Lwt.t</a>) -&gt; unit</code></pre><div class="info"><div class="info"><code class="code">add_hook switch f</code> registers <code class="code">f</code> so it will be called when
      TODO reference : turn_off is invoked. It does nothing if <code class="code">switch</code> is
      <code class="code">None</code>. If <code class="code">switch</code> contains an switch that is already off then
      TODO reference : Off is raised.</div></div>
<pre><span class="VALadd_hook_or_exec"><span class="keyword">val</span> add_hook_or_exec</span> : <code class="type"><a href="?package=lwt&amp;module=Lwt_switch&amp;type=t">t</a> option -&gt; (unit -&gt; unit <a href="?package=lwt&amp;module=Lwt&amp;type=t">Lwt.t</a>) -&gt; unit <a href="?package=lwt&amp;module=Lwt&amp;type=t">Lwt.t</a></code></pre><div class="info"><div class="info"><code class="code">add_hook_or_exec switch f</code> is the same as TODO reference : add_hook except
      that if the switch is already off, then <code class="code">f</code> is called
      immediatly.</div></div>
</div>
          </div>
        </div>
      </div>
    </div>
    <footer id="footer" class="navbar navbar-inverse navbar-fixed-bottom">
      <div class="navbar-inner">
        <div class="container-fluid">
          <ul class="nav pull-right">
            <li><a href="#">Feedback</a></li>
            <li><a href="#">Contact us</a></li>
            <li><a href="#">Find us on GitHub</a></li>
          </ul>
        </div>
      </div>
    </footer>
    <!-- Load javascript from CDN -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
    <script>octry('')</script>
  </body>
</html>
